# ‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –î–û–î–ï–õ–ê–¢–¨ - –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –º–æ–¥–µ–ª–µ–π

## üìã –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

**–í–∞—Ä–∏–∞–Ω—Ç 3 (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ) –ø—Ä–∏–º–µ–Ω–µ–Ω:**
- ‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç (health + public/plans)
- ‚úÖ –°–æ–∑–¥–∞–Ω –≤—Ä–µ–º–µ–Ω–Ω—ã–π `public_simple.py` (SQL –≤–º–µ—Å—Ç–æ ORM)
- ‚ö†Ô∏è `public.py`, `webhooks.py`, `super_admin.py` –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω—ã

## üîß –ß—Ç–æ –Ω—É–∂–Ω–æ –∏—Å–ø—Ä–∞–≤–∏—Ç—å

### 1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –º–æ–¥–µ–ª–µ–π `public_models.py` ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ `Base` (shared/models –∏ public_models)
- –ü—Ä–æ–±–ª–µ–º–∞ —Å `__table_args__` –∏ `metadata`
- SQLAlchemy –Ω–µ –º–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª–∏ –∏–∑-–∑–∞ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π `Base` –¥–ª—è –≤—Å–µ—Ö —Å—Ö–µ–º
- –ü—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `__table_args__` –¥–ª—è –∫–∞–∂–¥–æ–π —Å—Ö–µ–º—ã
- –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –∏ –ø—É—Ç–∏

**–§–∞–π–ª—ã:**
- `web/backend/app/models/public_models.py`
- `shared/database/models.py`

### 2. –í–∫–ª—é—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π `public.py` —Å ORM –º–æ–¥–µ–ª—è–º–∏ ‚ö†Ô∏è –í–ê–ñ–ù–û

**–ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å:**
- –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –º–æ–¥–µ–ª–µ–π
- –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `from app.api import public` –≤ `main.py`
- –£–¥–∞–ª–∏—Ç—å `public_simple.py`
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ endpoints

**–§–∞–π–ª—ã:**
- `web/backend/app/api/public.py`
- `web/backend/main.py`
- `web/backend/app/api/public_simple.py` (—É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)

### 3. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ `super_admin.py` ‚ö†Ô∏è –í–ê–ñ–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏–∑ `public_models.py`
- –ù–µ –º–æ–∂–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `Company`, `Plan`, `SuperAdmin`

**–†–µ—à–µ–Ω–∏–µ:**
- –í–∞—Ä–∏–∞–Ω—Ç A: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SQL –≤–º–µ—Å—Ç–æ ORM (–∫–∞–∫ –≤ `public_simple.py`)
- –í–∞—Ä–∏–∞–Ω—Ç B: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –º–æ–¥–µ–ª–µ–π –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–§–∞–π–ª—ã:**
- `web/backend/app/api/super_admin.py`

### 4. –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –≤ `webhooks.py` ‚ö†Ô∏è –í–ê–ñ–ù–û

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–æ–±–ª–µ–º–Ω—ã–µ –º–æ–¥–µ–ª–∏ –∏–∑ `public_models.py`
- –ù–µ –º–æ–∂–µ—Ç –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å `Company`, `Payment`, `Subscription`

**–†–µ—à–µ–Ω–∏–µ:**
- –í–∞—Ä–∏–∞–Ω—Ç A: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SQL –≤–º–µ—Å—Ç–æ ORM (–∫–∞–∫ –≤ `public_simple.py`)
- –í–∞—Ä–∏–∞–Ω—Ç B: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç—ã –º–æ–¥–µ–ª–µ–π –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

**–§–∞–π–ª—ã:**
- `web/backend/app/api/webhooks.py`

### 5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ endpoints ‚ö†Ô∏è –í–ê–ñ–ù–û

**–ß—Ç–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**
- ‚úÖ `GET /api/public/plans` - —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚ö†Ô∏è `POST /api/public/companies/register` - –Ω—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- ‚ö†Ô∏è `POST /api/public/webhooks/yookassa` - –Ω—É–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å
- ‚ö†Ô∏è `GET /api/super-admin/*` - –Ω—É–∂–Ω–æ –≤–∫–ª—é—á–∏—Ç—å –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å

## üìù –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ö–æ–Ω—Ñ–ª–∏–∫—Ç Base

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
```python
# shared/database/models.py
Base = declarative_base()

# web/backend/app/models/public_models.py
from shared.database.models import Base  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç Base
# –ù–æ SQLAlchemy –≤–∏–¥–∏—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–æ–¥–µ–ª–µ–π
```

**–û—à–∏–±–∫–∞:**
```
sqlalchemy.exc.ArgumentError: __table_args__ value must be a tuple, dict, or None
sqlalchemy.exc.InvalidRequestError: Attribute name 'metadata' is reserved
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: __table_args__ —Ñ–æ—Ä–º–∞—Ç

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
```python
__table_args__ = public_metadata  # –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
```

**–ù—É–∂–Ω–æ:**
```python
__table_args__ = {"schema": "public"}  # –ü—Ä–∞–≤–∏–ª—å–Ω–æ
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Metadata –∫–æ–Ω—Ñ–ª–∏–∫—Ç

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- –í –º–æ–¥–µ–ª–∏ `Subscription` –µ—Å—Ç—å –ø–æ–ª–µ `metadata = Column(Text, nullable=True)`
- SQLAlchemy —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç –∏–º—è `metadata` –¥–ª—è —Å–≤–æ–∏—Ö —Ü–µ–ª–µ–π
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–æ–¥–µ–ª–∏

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ø–æ–ª–µ `metadata` –≤ `subscription_metadata` –∏–ª–∏ `extra_data`
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥

## üéØ –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –≠—Ç–∞–ø 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –º–æ–¥–µ–ª–µ–π (1-2 —á–∞—Å–∞)

1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç Base –≤ `public_models.py`
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å `__table_args__` –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
3. ‚úÖ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ø–æ–ª–µ `metadata` –≤ –º–æ–¥–µ–ª—è—Ö
4. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

### –≠—Ç–∞–ø 2: –í–∫–ª—é—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ –º–æ–¥—É–ª–∏ (30 –º–∏–Ω—É—Ç)

1. ‚úÖ –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `public.py` –≤ `main.py`
2. ‚úÖ –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `webhooks.py` –≤ `main.py`
3. ‚úÖ –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `super_admin.py` –≤ `main.py`
4. ‚úÖ –£–¥–∞–ª–∏—Ç—å `public_simple.py`

### –≠—Ç–∞–ø 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (1 —á–∞—Å)

1. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å `GET /api/public/plans`
2. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å `POST /api/public/companies/register`
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å `POST /api/public/webhooks/yookassa`
4. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ `super-admin` endpoints

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [SQLAlchemy Declarative Base](https://docs.sqlalchemy.org/en/14/orm/declarative_tables.html)
- [SQLAlchemy Table Args](https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table)
- [SQLAlchemy Multi-Tenancy](https://docs.sqlalchemy.org/en/14/core/connections.html#connection-pooling)

## ‚úÖ –¢–µ–∫—É—â–∏–π —Å—Ç–∞—Ç—É—Å

- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã (5 —Ç–∞–±–ª–∏—Ü –≤ public —Å—Ö–µ–º–µ)
- ‚úÖ –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã (3 –ø–ª–∞–Ω–∞ + 1 —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)
- ‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç (health + public/plans —á–µ—Ä–µ–∑ public_simple.py)
- ‚ö†Ô∏è –í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ (public_simple.py –≤–º–µ—Å—Ç–æ public.py)
- ‚ö†Ô∏è webhooks –∏ super_admin –≤—Ä–µ–º–µ–Ω–Ω–æ –æ—Ç–∫–ª—é—á–µ–Ω—ã
- ‚ö†Ô∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–µ–π —Ç—Ä–µ–±—É–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2026-01-06  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π  
**–°—Ç–∞—Ç—É—Å:** –í —Ä–∞–±–æ—Ç–µ (–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–æ)

