# ‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–û - –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–µ–π

## üìã –¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è

**–í—Å–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã:**
- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–µ–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- ‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã –æ–±—Ä–∞—Ç–Ω–æ (public, webhooks, super_admin, subscription)
- ‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Å –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–º ORM
- ‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã (public_simple.py, super_admin_simple.py)
- ‚úÖ –í—Å–µ endpoints –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

### 1. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–µ–π `public_models.py`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `Base` –∏–∑ `shared.database.models`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω `__table_args__ = {"schema": "public"}` –¥–ª—è –≤—Å–µ—Ö –º–æ–¥–µ–ª–µ–π
- ‚úÖ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–æ –ø–æ–ª–µ `metadata` ‚Üí `extra_data` (—Ç–∏–ø `JSONB`)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏–º–µ–Ω–∞ enum (`subscription_status`, `payment_status`)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∑–Ω–∞—á–µ–Ω–∏—è enum (`SUCCEEDED` –≤–º–µ—Å—Ç–æ `COMPLETED`, `active` –≤–º–µ—Å—Ç–æ `ACTIVE`)
- ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫ –≤ –ë–î

**–§–∞–π–ª—ã:**
- ‚úÖ `web/backend/app/models/public_models.py` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- ‚úÖ `web/backend/alembic/versions/002_rename_metadata_to_extra_data.py` - —Å–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è

### 2. ‚úÖ –í–∫–ª—é—á–µ–Ω –æ–±—Ä–∞—Ç–Ω–æ –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π `public.py` —Å ORM –º–æ–¥–µ–ª—è–º–∏

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω `from app.api import public` –≤ `main.py`
- ‚úÖ –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω `app.include_router(public.router)` –≤ `main.py`
- ‚úÖ –£–¥–∞–ª–µ–Ω `public_simple.py`
- ‚úÖ –í—Å–µ endpoints —Ä–∞–±–æ—Ç–∞—é—Ç —Å ORM –º–æ–¥–µ–ª—è–º–∏

**–§–∞–π–ª—ã:**
- ‚úÖ `web/backend/app/api/public.py` - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å ORM
- ‚úÖ `web/backend/app/main.py` - –≤–∫–ª—é—á–µ–Ω router
- ‚úÖ `web/backend/app/api/public_simple.py` - —É–¥–∞–ª–µ–Ω

### 3. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –≤ `super_admin.py`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –º–æ–¥–µ–ª–µ–π –∏–∑ `app.models.public_models`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è (bcrypt –Ω–∞–ø—Ä—è–º—É—é)
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ enum (—Å—Ç—Ä–æ–∫–∏ —á–µ—Ä–µ–∑ `text()`)
- ‚úÖ –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω `from app.api import super_admin` –≤ `main.py`
- ‚úÖ –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω `app.include_router(super_admin.router)` –≤ `main.py`
- ‚úÖ –£–¥–∞–ª–µ–Ω `super_admin_simple.py`

**–§–∞–π–ª—ã:**
- ‚úÖ `web/backend/app/api/super_admin.py` - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å ORM
- ‚úÖ `web/backend/app/main.py` - –≤–∫–ª—é—á–µ–Ω router
- ‚úÖ `web/backend/app/api/super_admin_simple.py` - —É–¥–∞–ª–µ–Ω

### 4. ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –≤ `webhooks.py`

**–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ:**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –º–æ–¥–µ–ª–µ–π –∏–∑ `app.models.public_models`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `payment.extra_data` –≤–º–µ—Å—Ç–æ `payment.metadata`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `PaymentStatus.SUCCEEDED`
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç `initialize_tenant_for_company` –∏–∑ `tenant_service`
- ‚úÖ –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω `from app.api import webhooks` –≤ `main.py`
- ‚úÖ –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω `app.include_router(webhooks.router)` –≤ `main.py`

**–§–∞–π–ª—ã:**
- ‚úÖ `web/backend/app/api/webhooks.py` - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å ORM
- ‚úÖ `web/backend/app/main.py` - –≤–∫–ª—é—á–µ–Ω router

### 5. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤—Å–µ endpoints

**–ß—Ç–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ:**
- ‚úÖ `GET /api/public/plans` - —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ `POST /api/public/companies/register` - —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ `POST /api/public/webhooks/yookassa` - —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ `GET /api/super-admin/auth/login` - —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ `GET /api/super-admin/dashboard/stats` - —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ `GET /api/super-admin/companies` - —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ `super-admin` endpoints - —Ä–∞–±–æ—Ç–∞—é—Ç

## üìù –î–µ—Ç–∞–ª–∏ –ø—Ä–æ–±–ª–µ–º

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –ö–æ–Ω—Ñ–ª–∏–∫—Ç Base

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
```python
# shared/database/models.py
Base = declarative_base()

# web/backend/app/models/public_models.py
from shared.database.models import Base  # –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç Base
# –ù–æ SQLAlchemy –≤–∏–¥–∏—Ç –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–æ–¥–µ–ª–µ–π
```

**–û—à–∏–±–∫–∞:**
```
sqlalchemy.exc.ArgumentError: __table_args__ value must be a tuple, dict, or None
sqlalchemy.exc.InvalidRequestError: Attribute name 'metadata' is reserved
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: __table_args__ —Ñ–æ—Ä–º–∞—Ç

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
```python
__table_args__ = public_metadata  # –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ
```

**–ù—É–∂–Ω–æ:**
```python
__table_args__ = {"schema": "public"}  # –ü—Ä–∞–≤–∏–ª—å–Ω–æ
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: Metadata –∫–æ–Ω—Ñ–ª–∏–∫—Ç

**–¢–µ–∫—É—â–∞—è —Å–∏—Ç—É–∞—Ü–∏—è:**
- –í –º–æ–¥–µ–ª–∏ `Subscription` –µ—Å—Ç—å –ø–æ–ª–µ `metadata = Column(Text, nullable=True)`
- SQLAlchemy —Ä–µ–∑–µ—Ä–≤–∏—Ä—É–µ—Ç –∏–º—è `metadata` –¥–ª—è —Å–≤–æ–∏—Ö —Ü–µ–ª–µ–π
- –ö–æ–Ω—Ñ–ª–∏–∫—Ç –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –º–æ–¥–µ–ª–∏

**–†–µ—à–µ–Ω–∏–µ:**
- –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ø–æ–ª–µ `metadata` –≤ `subscription_metadata` –∏–ª–∏ `extra_data`
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –ø–æ–¥—Ö–æ–¥

## üéØ –ü–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### –≠—Ç–∞–ø 1: –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É –º–æ–¥–µ–ª–µ–π (1-2 —á–∞—Å–∞)

1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å –∏–º–ø–æ—Ä—Ç Base –≤ `public_models.py`
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å `__table_args__` –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
3. ‚úÖ –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞—Ç—å –ø–æ–ª–µ `metadata` –≤ –º–æ–¥–µ–ª—è—Ö
4. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

### –≠—Ç–∞–ø 2: –í–∫–ª—é—á–∏—Ç—å –æ–±—Ä–∞—Ç–Ω–æ –º–æ–¥—É–ª–∏ (30 –º–∏–Ω—É—Ç)

1. ‚úÖ –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `public.py` –≤ `main.py`
2. ‚úÖ –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `webhooks.py` –≤ `main.py`
3. ‚úÖ –†–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å `super_admin.py` –≤ `main.py`
4. ‚úÖ –£–¥–∞–ª–∏—Ç—å `public_simple.py`

### –≠—Ç–∞–ø 3: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (1 —á–∞—Å)

1. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å `GET /api/public/plans`
2. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å `POST /api/public/companies/register`
3. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å `POST /api/public/webhooks/yookassa`
4. ‚úÖ –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ `super-admin` endpoints

## üìö –ü–æ–ª–µ–∑–Ω—ã–µ —Å—Å—ã–ª–∫–∏

- [SQLAlchemy Declarative Base](https://docs.sqlalchemy.org/en/14/orm/declarative_tables.html)
- [SQLAlchemy Table Args](https://docs.sqlalchemy.org/en/14/core/metadata.html#sqlalchemy.schema.Table)
- [SQLAlchemy Multi-Tenancy](https://docs.sqlalchemy.org/en/14/core/connections.html#connection-pooling)

## ‚úÖ –§–∏–Ω–∞–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å

- ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã (5 —Ç–∞–±–ª–∏—Ü –≤ public —Å—Ö–µ–º–µ)
- ‚úÖ –ù–∞—á–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã (3 –ø–ª–∞–Ω–∞ + 1 —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä)
- ‚úÖ API —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é (–≤—Å–µ endpoints —Å ORM)
- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –º–æ–¥–µ–ª–µ–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∞
- ‚úÖ –í—Å–µ –º–æ–¥—É–ª–∏ –≤–∫–ª—é—á–µ–Ω—ã –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —É–¥–∞–ª–µ–Ω—ã
- ‚úÖ –í—Å–µ endpoints –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã

---

## üìã –ß—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å (—Å–º. REMAINING_TASKS_SUMMARY.md)

1. **–≠—Ç–∞–ø 1:** –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î - –∑–∞–≤–µ—Ä—à–∏—Ç—å –ø–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö –≤ tenant —Å—Ö–µ–º—É
2. **–≠—Ç–∞–ø 3:** Backend –º—É–ª—å—Ç–∏-—Ç–µ–Ω–∞–Ω—Ç–Ω–æ—Å—Ç—å - –æ–±–Ω–æ–≤–∏—Ç—å CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ –∏ —Å–æ–∑–¥–∞—Ç—å Middleware
3. **–≠—Ç–∞–ø 4:** Backend –ø—É–±–ª–∏—á–Ω—ã–π API - —Å–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å—ã (company, subscription, payment)
4. **–≠—Ç–∞–ø 11:** –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ - —Å–æ–∑–¥–∞—Ç—å unit, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∏ E2E —Ç–µ—Å—Ç—ã
5. **–≠—Ç–∞–ø 12:** –î–µ–ø–ª–æ–π - –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É
6. **–≠—Ç–∞–ø 13:** –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è - —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞

---

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 2026-01-06  
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** 2026-01-06  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ **–ó–ê–í–ï–†–®–ï–ù–û**

