# üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–ø—É—Å–∫–∞ —Ç–µ—Å—Ç–æ–≤

**–î–∞—Ç–∞:** 2026-01-14  
**–ö–æ–º–∞–Ω–¥–∞:** `pytest web/backend/tests/unit/test_tenant_deps.py -v`

---

## ‚úÖ –£—Å–ø–µ—à–Ω—ã–µ —Ç–µ—Å—Ç—ã (8 –∏–∑ 11)

### TestResolveCompanyId
- ‚úÖ `test_resolve_from_query_param` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ company_id –∏–∑ query –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
- ‚úÖ `test_resolve_from_request_state` - –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ company_id –∏–∑ request.state
- ‚úÖ `test_resolve_priority_query_over_state` - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç query –Ω–∞–¥ state
- ‚úÖ `test_resolve_priority_state_over_jwt` - –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç state –Ω–∞–¥ JWT
- ‚úÖ `test_resolve_none_when_no_sources` - –≤–æ–∑–≤—Ä–∞—Ç None –∫–æ–≥–¥–∞ –Ω–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
- ‚úÖ `test_resolve_invalid_jwt_token` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–≥–æ JWT —Ç–æ–∫–µ–Ω–∞
- ‚úÖ `test_resolve_jwt_without_company_id` - –æ–±—Ä–∞–±–æ—Ç–∫–∞ JWT –±–µ–∑ company_id

### TestGetTenantDb
- ‚úÖ `test_get_tenant_db_no_company_id` - –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ company_id

---

## ‚ùå –ù–µ—É—Å–ø–µ—à–Ω—ã–µ —Ç–µ—Å—Ç—ã (3 –∏–∑ 11)

### –ü—Ä–∏—á–∏–Ω–∞: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ë–î
–í—Å–µ –Ω–µ—É—Å–ø–µ—à–Ω—ã–µ —Ç–µ—Å—Ç—ã —Ç—Ä–µ–±—É—é—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL —Å —Ä–æ–ª—å—é `barber_user`, –∫–æ—Ç–æ—Ä–∞—è –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –ª–æ–∫–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏.

**–ù–µ—É—Å–ø–µ—à–Ω—ã–µ —Ç–µ—Å—Ç—ã:**
1. ‚ùå `test_resolve_from_jwt_token` - —Ç—Ä–µ–±—É–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ SECRET_KEY
2. ‚ùå `test_get_tenant_db_success` - —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
3. ‚ùå `test_get_tenant_db_invalid_company_id` - —Ç—Ä–µ–±—É–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

**–†–µ—à–µ–Ω–∏–µ:**
- –ó–∞–ø—É—Å–∫–∞—Ç—å —Ç–µ—Å—Ç—ã –≤ Docker –æ–∫—Ä—É–∂–µ–Ω–∏–∏ (–≥–¥–µ –ë–î –¥–æ—Å—Ç—É–ø–Ω–∞)
- –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—É—é —Ç–µ—Å—Ç–æ–≤—É—é –ë–î
- –ò–ª–∏ –º–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î –¥–ª—è unit —Ç–µ—Å—Ç–æ–≤

---

## üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

- **–í—Å–µ–≥–æ —Ç–µ—Å—Ç–æ–≤:** 11
- **–£—Å–ø–µ—à–Ω–æ:** 8 (73%)
- **–ù–µ—É—Å–ø–µ—à–Ω–æ:** 3 (27%)
- **–ü—Ä–∏—á–∏–Ω–∞ –Ω–µ—É–¥–∞—á:** –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ë–î (–æ–∂–∏–¥–∞–µ–º–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞)

---

## üéØ –í—ã–≤–æ–¥—ã

1. ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç** - pytest –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã
2. ‚úÖ **–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ unit —Ç–µ—Å—Ç–æ–≤ –ø—Ä–æ—Ö–æ–¥—è—Ç** - –ª–æ–≥–∏–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è company_id —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. ‚ö†Ô∏è **–¢–µ—Å—Ç—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –ë–î, –Ω–µ –ø—Ä–æ—Ö–æ–¥—è—Ç** - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –±–µ–∑ Docker

---

## üöÄ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–æ–ª—å–∫–æ —Ç–µ—Å—Ç—ã –±–µ–∑ –ë–î
pytest web/backend/tests/unit/test_tenant_deps.py::TestResolveCompanyId -v
```

### –î–ª—è –ø–æ–ª–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞:
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤ Docker –æ–∫—Ä—É–∂–µ–Ω–∏–∏
docker-compose exec web pytest tests/ -v
```

### –î–ª—è CI/CD:
–¢–µ—Å—Ç—ã –¥–æ–ª–∂–Ω—ã –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –≤ Docker –æ–∫—Ä—É–∂–µ–Ω–∏–∏, –≥–¥–µ –ë–î –¥–æ—Å—Ç—É–ø–Ω–∞.

---

## üìù –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ –ë–∞–∑–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ç–µ—Å—Ç–æ–≤ —Å–æ–∑–¥–∞–Ω–∞
2. ‚úÖ –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ unit —Ç–µ—Å—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞—é—Ç
3. ‚è≥ –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –ë–î –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤
4. ‚è≥ –î–æ–±–∞–≤–∏—Ç—å –º–æ–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–æ–≤, —Ç—Ä–µ–±—É—é—â–∏—Ö –ë–î
5. ‚è≥ –†–∞—Å—à–∏—Ä–∏—Ç—å –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

---

**–°—Ç–∞—Ç—É—Å:** ‚úÖ –¢–µ—Å—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç, —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ë–î –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
