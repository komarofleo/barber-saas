# –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏ –º–∏–≥—Ä–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 2-3 –¥–Ω—è  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –í –æ–∂–∏–¥–∞–Ω–∏–∏  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–¶–µ–ª—å —ç—Ç–∞–ø–∞](#—Ü–µ–ª—å-—ç—Ç–∞–ø–∞)
2. [–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
3. [–ü–æ–¥–∑–∞–¥–∞—á–∏](#–ø–æ–¥–∑–∞–¥–∞—á–∏)
4. [–ß–µ–∫-–ª–∏—Å—Ç —ç—Ç–∞–ø–∞](#—á–µ–∫-–ª–∏—Å—Ç-—ç—Ç–∞–ø–∞)
5. [–†–∏—Å–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏–µ](#—Ä–∏—Å–∫–∏-–∏-–∏—Ö-—Ä–µ—à–µ–Ω–∏–µ)

---

## üéØ –¶–µ–ª—å —ç—Ç–∞–ø–∞

–ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –≤ –º—É–ª—å—Ç–∏-—Ç–µ–Ω–∞–Ω—Ç–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É, —Å–æ—Ö—Ä–∞–Ω–∏–≤ –ø–æ–ª–Ω—É—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å —Å–∏—Å—Ç–µ–º—ã.

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

- –°—Ö–µ–º–∞ `public` —Å–æ–¥–µ—Ä–∂–∏—Ç —Ç–æ–ª—å–∫–æ –æ–±—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã (companies, subscriptions, plans, payments, super_admins)
- –°—Ö–µ–º–∞ `tenant_001` —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- –¢–µ–∫—É—â–∏–π –∫–ª–∏–µ–Ω—Ç –∏–º–µ–µ—Ç –∑–∞–ø–∏—Å—å –≤ —Ç–∞–±–ª–∏—Ü–µ `companies`
- –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –î–∞–Ω–Ω—ã–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã

---

## üîß –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã

- [ ] –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø —Ç–µ–∫—É—â–µ–π –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
- [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π –≤ –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü–µ)
- [ ] –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞
- [ ] –ü–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- PostgreSQL 15+ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- Python 3.11+ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- –î–æ—Å—Ç—É–ø –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö (–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –ø—Ä–∞–≤–∞–º–∏ CREATE SCHEMA)
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏: `sqlalchemy`, `asyncpg`, `alembic`

---

## üìù –ü–æ–¥–∑–∞–¥–∞—á–∏

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.1: –°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–ª—è –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü –≤ —Å—Ö–µ–º–µ `public`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å Alembic –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–æ–≤—ã—Ö —Ç–∞–±–ª–∏—Ü –≤ —Å—Ö–µ–º—É `public`.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏:
   ```
   alembic/versions/001_add_multi_tenant_tables.py
   ```

2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–æ–≤—ã–µ –º–æ–¥–µ–ª–∏:
   - `Company`
   - `Plan`
   - `Subscription`
   - `Payment`
   - `SuperAdmin`

3. –°–æ–∑–¥–∞—Ç—å SQL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü:
   ```sql
   CREATE TABLE companies (...);
   CREATE TABLE plans (...);
   CREATE TABLE subscriptions (...);
   CREATE TABLE payments (...);
   CREATE TABLE super_admins (...);
   ```

4. –°–æ–∑–¥–∞—Ç—å –∏–Ω–¥–µ–∫—Å—ã:
   - `idx_companies_code`
   - `idx_companies_subscription_status`
   - `idx_plans_active`
   - `idx_subscriptions_company`
   - `idx_subscriptions_status`
   - `idx_subscriptions_end_date`
   - `idx_payments_company`
   - `idx_payments_status`
   - `idx_payments_payment_date`
   - `idx_super_admins_telegram`

5. –î–æ–±–∞–≤–∏—Ç—å foreign keys:
   - `subscriptions.company_id` ‚Üí `companies.id`
   - `subscriptions.plan_id` ‚Üí `plans.id`
   - `payments.company_id` ‚Üí `companies.id`
   - `payments.subscription_id` ‚Üí `subscriptions.id`

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞ –≤ `alembic/versions/`
- [ ] –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –í—Å–µ –∏–Ω–¥–µ–∫—Å—ã —Å–æ–∑–¥–∞–Ω—ã
- [ ] –í—Å–µ foreign keys —Å–æ–∑–¥–∞–Ω—ã
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ `alembic upgrade head`

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.2: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã

**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å Alembic –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏ —Ç—Ä–µ—Ö —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–æ–≤ –≤ —Ç–∞–±–ª–∏—Ü—É `plans`.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏:
   ```
   alembic/versions/002_init_plans.py
   ```

2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∞—Ä–∏—Ñ–Ω—ã–µ –ø–ª–∞–Ω—ã:
   - **Starter:** 2990‚ÇΩ/–º–µ—Å, 3 –º–∞—Å—Ç–µ—Ä–∞, 2 –ø–æ—Å—Ç–∞, 20 –∑–∞–ø–∏—Å–µ–π/–¥–µ–Ω—å
   - **Pro:** 4990‚ÇΩ/–º–µ—Å, 10 –º–∞—Å—Ç–µ—Ä–æ–≤, 5 –ø–æ—Å—Ç–æ–≤, 50 –∑–∞–ø–∏—Å–µ–π/–¥–µ–Ω—å
   - **Business:** 9990‚ÇΩ/–º–µ—Å, –±–µ–∑–ª–∏–º–∏—Ç

3. –°–æ–∑–¥–∞—Ç—å SQL –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏:
   ```sql
   INSERT INTO plans (name, price_monthly, max_users, max_masters, max_posts, max_bookings_per_day, features) VALUES
   ('Starter', 2990.00, 100, 3, 2, 20, '{"notifications": true, "statistics": false, "export": false, "promocodes": false}'),
   ('Pro', 4990.00, 500, 10, 5, 50, '{"notifications": true, "statistics": true, "export": true, "promocodes": true, "broadcasts": false}'),
   ('Business', 9990.00, 9999, 9999, 9999, 9999, '{"notifications": true, "statistics": true, "export": true, "promocodes": true, "broadcasts": true, "api_access": true}');
   ```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [ ] –¢—Ä–∏ —Ç–∞—Ä–∏—Ñ–Ω—ã—Ö –ø–ª–∞–Ω–∞ –≤—Å—Ç–∞–≤–ª–µ–Ω—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω—ã –ø–æ–ª—è JSON features
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.3: –°–æ–∑–¥–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö

**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å Python —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ —Å—Ö–µ–º—ã `public` –≤ —Å—Ö–µ–º—É `tenant_001`.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª:
   ```
   scripts/migrate_to_multi_tenant.py
   ```

2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É —Å–∫—Ä–∏–ø—Ç–∞:
   - –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î
   - –°–æ–∑–¥–∞–Ω–∏–µ —Å—Ö–µ–º—ã `tenant_001`
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞
   - –ü–µ—Ä–µ–Ω–æ—Å –∫–∞–∂–¥–æ–π —Ç–∞–±–ª–∏—Ü—ã:
     - `CREATE TABLE tenant_001.table AS SELECT * FROM public.table`
     - –ü–µ—Ä–µ–Ω–æ—Å –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π
     - –ü–µ—Ä–µ–Ω–æ—Å –∏–Ω–¥–µ–∫—Å–æ–≤
     - –ü–µ—Ä–µ–Ω–æ—Å foreign keys
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø–∏—Å–µ–π
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ—Ü–µ—Å—Å–∞

3. –î–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫:
   - Rollback –ø—Ä–∏ –æ—à–∏–±–∫–µ
   - –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
   - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

4. –î–æ–±–∞–≤–∏—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ã –∫–æ–º–∞–Ω–¥–Ω–æ–π —Å—Ç—Ä–æ–∫–∏:
   - `--dry-run` - —Ç–æ–ª—å–∫–æ –ø–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ –±—É–¥–µ—Ç —Å–¥–µ–ª–∞–Ω–æ
   - `--source-schema` - –∏—Å—Ö–æ–¥–Ω–∞—è —Å—Ö–µ–º–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `public`)
   - `--target-schema` - —Ü–µ–ª–µ–≤–∞—è —Å—Ö–µ–º–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é `tenant_001`)

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- [ ] –°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω
- [ ] –†–∞–±–æ—Ç–∞–µ—Ç —Ä–µ–∂–∏–º `--dry-run`
- [ ] –°—Ö–µ–º–∞ `tenant_001` —Å–æ–∑–¥–∞–µ—Ç—Å—è
- [ ] –í—Å–µ —Ç–∞–±–ª–∏—Ü—ã –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è
- [ ] –ü–µ—Ä–≤–∏—á–Ω—ã–µ –∫–ª—é—á–∏ –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è
- [ ] –ò–Ω–¥–µ–∫—Å—ã –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è
- [ ] Foreign keys –ø–µ—Ä–µ–Ω–æ—Å—è—Ç—Å—è
- [ ] –î–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.4: –°–æ–∑–¥–∞—Ç—å —Å—Ö–µ–º—É `tenant_001` —á–µ—Ä–µ–∑ –º–∏–≥—Ä–∞—Ü–∏—é

**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å Alembic –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ö–µ–º—ã `tenant_001`.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª –º–∏–≥—Ä–∞—Ü–∏–∏:
   ```
   alembic/versions/003_create_tenant_001_schema.py
   ```

2. –°–æ–∑–¥–∞—Ç—å SQL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Å—Ö–µ–º—ã:
   ```sql
   CREATE SCHEMA IF NOT EXISTS tenant_001;
   ```

3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å search_path –¥–ª—è –Ω–æ–≤–æ–π —Å—Ö–µ–º—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   ```sql
   SET search_path TO tenant_001, public;
   ```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞
- [ ] –°—Ö–µ–º–∞ `tenant_001` —Å–æ–∑–¥–∞–µ—Ç—Å—è
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ—Ö–æ–¥–∏—Ç —É—Å–ø–µ—à–Ω–æ
- [ ] –ú–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —Å—Ö–µ–º–µ

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.5: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:
   ```bash
   docker compose exec postgres psql -U autoservice_user -d postgres -c "CREATE DATABASE autoservice_test;"
   ```

2. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Ç–µ–∫—É—â–µ–π –±–∞–∑—ã:
   ```bash
   pg_dump -U autoservice_user autoservice_db | psql -U autoservice_user autoservice_test
   ```

3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ —Ç–µ—Å—Ç–æ–≤—É—é –±–∞–∑—É:
   ```bash
   # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –≤ public
   alembic upgrade head

   # –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö
   python scripts/migrate_to_multi_tenant.py --dry-run
   python scripts/migrate_to_multi_tenant.py
   ```

4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
   ```sql
   -- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ö–µ–º—ã
   \dn

   -- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã –≤ public
   SELECT table_name FROM information_schema.tables WHERE table_schema = 'public';

   -- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã –≤ tenant_001
   SELECT table_name FROM information_schema.tables WHERE table_schema = 'tenant_001';

   -- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
   SELECT COUNT(*) FROM tenant_001.users;
   SELECT COUNT(*) FROM tenant_001.bookings;
   ```

5. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
   - –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞
   - –ó–∞–ø—É—Å–∫ backend
   - –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–π –∑–∞–ø–∏—Å–∏
   - –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø–∏—Å–µ–π

6. –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
   - –í—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏
   - –û–±—ä–µ–º –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - –û—à–∏–±–∫–∏ –∏ –ø—Ä–æ–±–ª–µ–º—ã

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- [ ] –¢–µ—Å—Ç–æ–≤–∞—è –ë–î —Å–æ–∑–¥–∞–Ω–∞
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ
- [ ] –°–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–∏–ª—Å—è
- [ ] –í—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.6: –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω –ë–î

**–û–ø–∏—Å–∞–Ω–∏–µ:** –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö –Ω–∞ —Ä–∞–±–æ—á–µ–π –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –°–æ–∑–¥–∞—Ç—å —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –±—ç–∫–∞–ø:
   ```bash
   docker compose exec postgres pg_dump -U autoservice_user autoservice_db | gzip > backups/pre_migration_backup_$(date +%Y%m%d_%H%M%S).sql.gz
   ```

2. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∫—Ä–æ–º–µ postgres:
   ```bash
   docker compose stop web bot celery-worker celery-beat
   ```

3. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏:
   ```bash
   # –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–æ–≤—ã–µ —Ç–∞–±–ª–∏—Ü—ã –≤ public
   docker compose exec web alembic upgrade head
   ```

4. –°–æ–∑–¥–∞—Ç—å —Å—Ö–µ–º—É tenant_001:
   ```bash
   docker compose exec postgres psql -U autoservice_user -d autoservice_db -c "CREATE SCHEMA IF NOT EXISTS tenant_001;"
   ```

5. –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–∞–Ω–Ω—ã—Ö:
   ```bash
   docker compose exec web python scripts/migrate_to_multi_tenant.py
   ```

6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏:
   ```bash
   # –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –ë–î
   docker compose exec postgres psql -U autoservice_user -d autoservice_db

   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ö–µ–º—ã
   \dn

   # –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã –≤ tenant_001
   SELECT COUNT(*) FROM tenant_001.users;
   SELECT COUNT(*) FROM tenant_001.bookings;
   SELECT COUNT(*) FROM tenant_001.clients;
   ```

7. –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
   ```bash
   docker compose up -d
   ```

8. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `docker compose logs -f`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É backend
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø–∏—Å–µ–π

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- [ ] –ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω
- [ ] –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã
- [ ] –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã
- [ ] –†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–æ–≤–µ—Ä–µ–Ω –≤ –ë–î
- [ ] –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—â–µ–Ω—ã
- [ ] –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.7: –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –∫–æ–º–ø–∞–Ω–∏–∏ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞

**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –∫–æ–º–ø–∞–Ω–∏–∏ –≤ —Ç–∞–±–ª–∏—Ü–µ `companies` –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –¥–∞–Ω–Ω—ã–µ —Ç–µ–∫—É—â–µ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞:
   - –ù–∞–∑–≤–∞–Ω–∏–µ –∞–≤—Ç–æ—Å–µ—Ä–≤–∏—Å–∞
   - Email
   - –¢–µ–ª–µ—Ñ–æ–Ω
   - –¢–æ–∫–µ–Ω –±–æ—Ç–∞ (–∏–∑ `.env`)
   - –ò–º—è –±–æ—Ç–∞

2. –°–æ–∑–¥–∞—Ç—å SQL –¥–ª—è –≤—Å—Ç–∞–≤–∫–∏:
   ```sql
   INSERT INTO companies (
       name, 
       code, 
       email, 
       phone,
       telegram_bot_token, 
       telegram_bot_username,
       webhook_url,
       created_at, 
       is_active, 
       subscription_status, 
       subscription_end_date,
       max_users, 
       max_masters, 
       max_posts,
       can_create_bookings
   ) VALUES (
       '–¢–µ–∫—É—â–∏–π –∫–ª–∏–µ–Ω—Ç',
       'client-001',
       'info@current.ru',
       '+79991234567',
       '–í–ê–®_–¢–û–ö–ï–ù_–ë–û–¢–ê',
       '–í–ê–®_–ë–û–¢_USERNAME',
       NULL,
       NOW(),
       TRUE,
       'active',
       '2026-02-01',
       9999,
       9999,
       9999,
       TRUE
   );
   ```

3. –°–æ–∑–¥–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É:
   ```sql
   INSERT INTO subscriptions (
       company_id,
       plan_id,
       start_date,
       end_date,
       status
   ) VALUES (
       1,  -- ID –∫–æ–º–ø–∞–Ω–∏–∏
       3,  -- Business (–∏–ª–∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –ø–ª–∞–Ω)
       '2025-01-06',
       '2026-02-06',
       'active'
   );
   ```

4. –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å—å –ø–ª–∞—Ç–µ–∂–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):
   ```sql
   INSERT INTO payments (
       company_id,
       subscription_id,
       amount,
       currency,
       payment_date,
       payment_method,
       status
   ) VALUES (
       1,
       1,
       9990.00,
       'RUB',
       NOW(),
       'manual',
       'completed'
   );
   ```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- [ ] –ó–∞–ø–∏—Å—å –∫–æ–º–ø–∞–Ω–∏–∏ —Å–æ–∑–¥–∞–Ω–∞
- [ ] –ü–æ–¥–ø–∏—Å–∫–∞ —Å–æ–∑–¥–∞–Ω–∞
- [ ] –ü–ª–∞—Ç–µ–∂ —Å–æ–∑–¥–∞–Ω (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –î–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.8: –£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∏–∑ —Å—Ö–µ–º—ã `public`

**–û–ø–∏—Å–∞–Ω–∏–µ:** –£–¥–∞–ª–∏—Ç—å –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã –∏–∑ —Å—Ö–µ–º—ã `public` –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏.

**–ü–†–ï–î–£–ü–†–ï–ñ–î–ï–ù–ò–ï:** –í—ã–ø–æ–ª–Ω—è—Ç—å —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ —É—Å–ø–µ—à–Ω–æ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã!

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã:
   ```sql
   -- –°—Ä–∞–≤–Ω–∏—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞–ø–∏—Å–µ–π
   SELECT COUNT(*) FROM public.users;
   SELECT COUNT(*) FROM tenant_001.users;
   
   SELECT COUNT(*) FROM public.bookings;
   SELECT COUNT(*) FROM tenant_001.bookings;
   ```

2. –°–æ–∑–¥–∞—Ç—å –±—ç–∫–∞–ø (–Ω–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π):
   ```bash
   docker compose exec postgres pg_dump -U autoservice_user autoservice_db | gzip > backups/post_delete_backup_$(date +%Y%m%d_%H%M%S).sql.gz
   ```

3. –°–æ–∑–¥–∞—Ç—å SQL —Å–∫—Ä–∏–ø—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è:
   ```sql
   -- –£–¥–∞–ª–∏—Ç—å —Ç–∞–±–ª–∏—Ü—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ (–∏–∑-–∑–∞ foreign keys)
   DROP TABLE IF EXISTS public.booking_history CASCADE;
   DROP TABLE IF EXISTS public.client_history CASCADE;
   DROP TABLE IF EXISTS public.notifications CASCADE;
   DROP TABLE IF EXISTS public.broadcasts CASCADE;
   DROP TABLE IF EXISTS public.promotions CASCADE;
   DROP TABLE IF EXISTS public.promocodes CASCADE;
   DROP TABLE IF EXISTS public.blocked_slots CASCADE;
   DROP TABLE IF EXISTS public.timeslots CASCADE;
   DROP TABLE IF EXISTS public.bookings CASCADE;
   DROP TABLE IF EXISTS public.master_services CASCADE;
   DROP TABLE IF EXISTS public.posts CASCADE;
   DROP TABLE IF EXISTS public.masters CASCADE;
   DROP TABLE IF EXISTS public.services CASCADE;
   DROP TABLE IF EXISTS public.clients CASCADE;
   DROP TABLE IF EXISTS public.users CASCADE;
   ```

4. –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å–∫—Ä–∏–ø—Ç:
   ```bash
   docker compose exec postgres psql -U autoservice_user -d autoservice_db -f scripts/delete_old_tables.sql
   ```

5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
   ```sql
   -- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å—Ç–∞—Ä—ã—Ö —Ç–∞–±–ª–∏—Ü –Ω–µ—Ç
   SELECT table_name FROM information_schema.tables 
   WHERE table_schema = 'public' 
   AND table_name IN ('users', 'clients', 'bookings', 'services', 'masters', 'posts');
   ```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- [ ] –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
- [ ] –ë—ç–∫–∞–ø —Å–æ–∑–¥–∞–Ω
- [ ] –°–∫—Ä–∏–ø—Ç —É–¥–∞–ª–µ–Ω–∏—è —Å–æ–∑–¥–∞–Ω
- [ ] –°—Ç–∞—Ä—ã–µ —Ç–∞–±–ª–∏—Ü—ã —É–¥–∞–ª–µ–Ω—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞
- [ ] –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 1.9: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É —Å–∏—Å—Ç–µ–º—ã –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü–æ–ª–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞:
   - –ó–∞–ø—É—Å–∫: `/start`
   - –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
   - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏
   - –ü—Ä–æ—Å–º–æ—Ç—Ä —Å–≤–æ–∏—Ö –∑–∞–ø–∏—Å–µ–π

2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É backend:
   - API health check: `curl http://localhost:8000/api/health`
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –∑–∞–ø–∏—Å–µ–π
   - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ —á–µ—Ä–µ–∑ API
   - –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —É—Å–ª—É–≥

3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É frontend:
   - –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
   - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
   - –ü—Ä–æ—Å–º–æ—Ç—Ä –∑–∞–ø–∏—Å–µ–π
   - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏

4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö:
   ```sql
   -- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å–µ –∑–∞–ø–∏—Å–∏ –Ω–∞ –º–µ—Å—Ç–µ
   SELECT COUNT(*) FROM tenant_001.bookings;
   SELECT COUNT(*) FROM tenant_001.users;
   SELECT COUNT(*) FROM tenant_001.clients;
   SELECT COUNT(*) FROM tenant_001.services;
   ```

5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É Celery –∑–∞–¥–∞—á:
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏: `docker compose logs celery-worker -f`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∑–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è

6. –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã:
   - –í—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
   - –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
   - –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–µ–º–ª–µ–º–∞

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- [ ] –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] Backend —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] Frontend —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] –î–∞–Ω–Ω—ã–µ —Ü–µ–ª—ã
- [ ] Celery –∑–∞–¥–∞—á–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
- [ ] –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç —ç—Ç–∞–ø–∞

### –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞

- [ ] –°–æ–∑–¥–∞–Ω –±—ç–∫–∞–ø —Ç–µ–∫—É—â–µ–π –ë–î
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω –æ–±—ä–µ–º –¥–∞–Ω–Ω—ã—Ö
- [ ] –û–ø—Ä–µ–¥–µ–ª–µ–Ω —Å–ø–∏—Å–æ–∫ —Ç–∞–±–ª–∏—Ü –¥–ª—è –ø–µ—Ä–µ–Ω–æ—Å–∞
- [ ] –°–æ–∑–¥–∞–Ω–∞ —Ç–µ—Å—Ç–æ–≤–∞—è –ë–î
- [ ] –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

### –ú–∏–≥—Ä–∞—Ü–∏–∏

- [ ] –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `001_add_multi_tenant_tables.py`
- [ ] –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `002_init_plans.py`
- [ ] –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è `003_create_tenant_001_schema.py`
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î
- [ ] –ú–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω

### –ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö

- [ ] –°–æ–∑–¥–∞–Ω —Å–∫—Ä–∏–ø—Ç `migrate_to_multi_tenant.py`
- [ ] –°–∫—Ä–∏–ø—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –≤ —Ä–µ–∂–∏–º–µ `--dry-run`
- [ ] –°–∫—Ä–∏–ø—Ç –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î
- [ ] –°–∫—Ä–∏–ø—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω –Ω–∞ –ø—Ä–æ–¥–∞–∫—à–µ–Ω
- [ ] –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é
- [ ] –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞

### –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏

- [ ] –ó–∞–ø–∏—Å—å –∫–æ–º–ø–∞–Ω–∏–∏ —Å–æ–∑–¥–∞–Ω–∞
- [ ] –ü–æ–¥–ø–∏—Å–∫–∞ —Å–æ–∑–¥–∞–Ω–∞
- [ ] –ü–ª–∞—Ç–µ–∂ —Å–æ–∑–¥–∞–Ω (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- [ ] –î–∞–Ω–Ω—ã–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

### –£–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Ç–∞–±–ª–∏—Ü

- [ ] –î–∞–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–µ–Ω—ã
- [ ] –°–æ–∑–¥–∞–Ω —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –±—ç–∫–∞–ø
- [ ] –°—Ç–∞—Ä—ã–µ —Ç–∞–±–ª–∏—Ü—ã —É–¥–∞–ª–µ–Ω—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ø–µ—à–Ω–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞

- [ ] –ë–æ—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Backend —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Frontend —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] Celery –∑–∞–¥–∞—á–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
- [ ] –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø—Ä–∏–µ–º–ª–µ–º–∞
- [ ] –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã

---

## ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏–µ

### –†–∏—Å–∫ 1: –ü–æ—Ç–µ—Ä—è –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è  
**–í–ª–∏—è–Ω–∏–µ:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–æ–µ

**–ú–µ—Ä—ã –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:**
- –°–æ–∑–¥–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞ –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ–∂–∏–º–∞ `--dry-run`
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**–†–µ—à–µ–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏:**
- –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑ –±—ç–∫–∞–ø–∞
- –ü–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Å–∫—Ä–∏–ø—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
- –ü–µ—Ä–µ–Ω–æ—Å –¥–∞–Ω–Ω—ã—Ö –≤—Ä—É—á–Ω—É—é

---

### –†–∏—Å–∫ 2: –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è  
**–í–ª–∏—è–Ω–∏–µ:** –°—Ä–µ–¥–Ω–µ–µ

**–ú–µ—Ä—ã –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Ç–∞–±–ª–∏—Ü
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- –ü—Ä–æ–≤–µ—Ä–∫–∞ foreign keys

**–†–µ—à–µ–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏:**
- –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- –£–¥–∞–ª–µ–Ω–∏–µ –ª–∏—à–Ω–∏—Ö foreign keys
- –†—É—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

---

### –†–∏—Å–∫ 3: –î–æ–ª–≥–æ–µ –≤—Ä–µ–º—è –º–∏–≥—Ä–∞—Ü–∏–∏

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è  
**–í–ª–∏—è–Ω–∏–µ:** –ù–∏–∑–∫–æ–µ

**–ú–µ—Ä—ã –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:**
- –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î
- –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ —Å–µ—Ä–≤–∏—Å–∞
- –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–†–µ—à–µ–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏:**
- –†–∞–∑–±–∏–≤–∫–∞ –Ω–∞ —ç—Ç–∞–ø—ã
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø–µ—Ä–µ–Ω–æ—Å

---

### –†–∏—Å–∫ 4: –û—à–∏–±–∫–∏ –≤ —Å–∫—Ä–∏–ø—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è  
**–í–ª–∏—è–Ω–∏–µ:** –°—Ä–µ–¥–Ω–µ–µ

**–ú–µ—Ä—ã –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:**
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ç–µ—Å—Ç–æ–≤–æ–π –ë–î
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π

**–†–µ—à–µ–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏:**
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—à–∏–±–æ–∫
- –ü–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ —Å–∫—Ä–∏–ø—Ç–∞
- –†—É—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:
   ```bash
   docker compose logs -f
   ```

2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ë–î:
   ```bash
   docker compose exec postgres psql -U autoservice_user -d autoservice_db
   ```

3. –í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±—ç–∫–∞–ø (–ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏):
   ```bash
   gunzip < backups/pre_migration_backup_YYYYMMDD_HHMMSS.sql.gz | docker compose exec -T postgres psql -U autoservice_user -d autoservice_db
   ```

---

**–≠—Ç–∞–ø 1 –∑–∞–≤–µ—Ä—à–µ–Ω:** [ ]  
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** _________  
**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:** _________________

