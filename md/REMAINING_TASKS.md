# üìã –û—Å—Ç–∞–≤—à–∏–µ—Å—è –∑–∞–¥–∞—á–∏ –ø–æ –ø–ª–∞–Ω—É

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ—É–Ω–∫—Ü–∏–π –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (Version 1.0.0)

---

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é

1. **Telegram –±–æ—Ç**
   - ‚úÖ –ö–ª–∏–µ–Ω—Ç—ã (–∑–∞–ø–∏—Å—å, –º–æ–∏ –∑–∞–ø–∏—Å–∏, –ø—Ä–æ—Ñ–∏–ª—å)
   - ‚úÖ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã (–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ, —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø–∏—Å—è–º–∏)
   - ‚úÖ –ú–∞—Å—Ç–µ—Ä–∞ (–ª–∏—Å—Ç-–Ω–∞—Ä—è–¥, –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π)

2. **–í–µ–±-–∞–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å**
   - ‚úÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å (–º–µ—Å—è—Ü/–Ω–µ–¥–µ–ª—è/–¥–µ–Ω—å)
   - ‚úÖ –¢–∞–±–ª–∏—Ü–∞ –∑–∞–ø–∏—Å–µ–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
   - ‚úÖ –°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏ (—É—Å–ª—É–≥–∏, –º–∞—Å—Ç–µ—Ä–∞, –ø–æ—Å—Ç—ã, –∫–ª–∏–µ–Ω—Ç—ã, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏)
   - ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ (–¥–∞—Ç, –º–∞—Å—Ç–µ—Ä–æ–≤, –ø–æ—Å—Ç–æ–≤, —É—Å–ª—É–≥)
   - ‚úÖ –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å –≥—Ä–∞—Ñ–∏–∫–∞–º–∏
   - ‚úÖ –ü—Ä–æ–º–æ–∫–æ–¥—ã –∏ –∞–∫—Ü–∏–∏
   - ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
   - ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ CSV

3. **–°–∏—Å—Ç–µ–º–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**
   - ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π —á–µ—Ä–µ–∑ –±–æ—Ç –∏ –≤–µ–±-–ø–∞–Ω–µ–ª—å
   - ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä–∞ –∏ –ø–æ—Å—Ç–∞
   - ‚úÖ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞–º–∏
   - ‚úÖ –ò—Å—Ç–æ—Ä–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

4. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**
   - ‚úÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ –¥–µ–Ω—å –¥–æ –∑–∞–ø–∏—Å–∏ (Celery task)
   - ‚úÖ –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ —á–∞—Å –¥–æ –∑–∞–ø–∏—Å–∏ (Celery task)
   - ‚úÖ –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞
   - ‚úÖ –ò—Å—Ç–æ—Ä–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤ –ë–î

5. **–ü—Ä–æ–º–æ–∫–æ–¥—ã –∏ –∞–∫—Ü–∏–∏**
   - ‚úÖ CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏
   - ‚úÖ –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–ø–∏—Å–∏
   - ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤

6. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏**
   - ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–∞—Ç
   - ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –º–∞—Å—Ç–µ—Ä–æ–≤
   - ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –ø–æ—Å—Ç–æ–≤
   - ‚úÖ –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —É—Å–ª—É–≥

---

## ‚ö†Ô∏è –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ / –¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏

### 1. –†–∞—Å—Å—ã–ª–∫–∏ (Broadcasts) üî¥

**–°—Ç–∞—Ç—É—Å:** API —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, –Ω–æ –æ—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ Telegram –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –§—É–Ω–∫—Ü–∏—è `send_broadcast_task()` –≤ `web/backend/app/api/broadcasts.py` —Å–æ–¥–µ—Ä–∂–∏—Ç TODO
- –û—Ç–ø—Ä–∞–≤–∫–∞ —Ä–∞—Å—Å—ã–ª–æ–∫ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- –§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –∑–∞–∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**
```python
# web/backend/app/api/broadcasts.py
async def send_broadcast_task(broadcast_id: int, db_url: str):
    """–§–æ–Ω–æ–≤–∞—è –∑–∞–¥–∞—á–∞ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ä–∞—Å—Å—ã–ª–∫–∏"""
    # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —á–µ—Ä–µ–∑ Telegram –±–æ—Ç
    # 1. –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π –Ω–∞ –æ—Å–Ω–æ–≤–µ target_audience –∏ filter_params
    # 2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ Telegram –±–æ—Ç
    # 3. –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Ä–∞—Å—Å—ã–ª–∫–∏ –∏ —Å—á–µ—Ç—á–∏–∫–∏ (total_sent, total_errors)
```

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π

---

### 2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ª–∏—Å—Ç-–Ω–∞—Ä—è–¥–æ–≤ –º–∞—Å—Ç–µ—Ä–∞–º üî¥

**–°—Ç–∞—Ç—É—Å:** –õ–∏—Å—Ç-–Ω–∞—Ä—è–¥ –µ—Å—Ç—å –≤ –±–æ—Ç–µ, –Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —É–∫–∞–∑–∞–Ω–æ, —á—Ç–æ Celery Task –≤ 08:00 –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –ª–∏—Å—Ç-–Ω–∞—Ä—è–¥—ã
- –í `web/backend/app/celery_app.py` –Ω–µ—Ç –∑–∞–¥–∞—á–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –ª–∏—Å—Ç-–Ω–∞—Ä—è–¥–æ–≤
- –ú–∞—Å—Ç–µ—Ä–∞ –º–æ–≥—É—Ç –∑–∞–ø—Ä–æ—Å–∏—Ç—å –ª–∏—Å—Ç-–Ω–∞—Ä—è–¥ –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ `/master`, –Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**
1. –°–æ–∑–¥–∞—Ç—å Celery task `send_work_orders_to_masters()` –≤ `web/backend/app/tasks/notifications.py`
2. –î–æ–±–∞–≤–∏—Ç—å –∑–∞–¥–∞—á—É –≤ `celery_app.conf.beat_schedule` —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –Ω–∞ 08:00
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É:
   - –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ—Ö –º–∞—Å—Ç–µ—Ä–æ–≤
   - –î–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞—Å—Ç–µ—Ä–∞ –ø–æ–ª—É—á–∏—Ç—å –∑–∞–ø–∏—Å–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å –ª–∏—Å—Ç-–Ω–∞—Ä—è–¥ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –°—Ä–µ–¥–Ω–∏–π

---

### 3. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –æ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å—è—Ö üî¥

**–°—Ç–∞—Ç—É—Å:** –í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —É–∫–∞–∑–∞–Ω–æ, –Ω–æ –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —É–∫–∞–∑–∞–Ω–æ: "Celery Task (5 –º–∏–Ω): notify_admin_new_bookings()"
- –í `web/backend/app/celery_app.py` –Ω–µ—Ç —Ç–∞–∫–æ–π –∑–∞–¥–∞—á–∏
- –í `web/backend/app/tasks/notifications.py` –Ω–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ `notify_admin_new_bookings()`

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**
1. –°–æ–∑–¥–∞—Ç—å —Ñ—É–Ω–∫—Ü–∏—é `notify_admin_new_bookings()` –≤ `web/backend/app/tasks/notifications.py`
2. –î–æ–±–∞–≤–∏—Ç—å Celery task –≤ `celery_app.py` —Å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç
3. –õ–æ–≥–∏–∫–∞:
   - –ù–∞–π—Ç–∏ –∑–∞–ø–∏—Å–∏ —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º "new", —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç –Ω–∞–∑–∞–¥
   - –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤—Å–µ–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
   - –ü–æ–º–µ—Ç–∏—Ç—å –∑–∞–ø–∏—Å–∏ –∫–∞–∫ "—É–≤–µ–¥–æ–º–ª–µ–Ω–æ" (–º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π –º–µ—Ö–∞–Ω–∏–∑–º)

**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –í—ã—Å–æ–∫–∏–π (–≤–∞–∂–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ—Å—Ç–∏)

---

## üìù –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ)

### 1. –ò—Å—Ç–æ—Ä–∏—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤

**–°—Ç–∞—Ç—É—Å:** –¢–∞–±–ª–∏—Ü–∞ `client_history` –µ—Å—Ç—å –≤ –ë–î, –Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π –≤ `client_history` –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∑–∞–ø–∏—Å–∏
- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ `clients.total_visits` –∏ `clients.total_amount`

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ callback –∫–Ω–æ–ø–æ–∫ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö

**–°—Ç–∞—Ç—É—Å:** –í —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö –µ—Å—Ç—å –∫–Ω–æ–ø–∫–∏ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —è–≤–∫—É", "–û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–ø–∏—Å—å", –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ `confirm_attendance_{booking_id}` –≤ –±–æ—Ç–µ
- –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ `cancel_booking_{booking_id}` –≤ –±–æ—Ç–µ

### 3. Rate limiting –¥–ª—è API

**–°—Ç–∞—Ç—É—Å:** –í –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ —É–∫–∞–∑–∞–Ω–æ, –Ω–æ –Ω—É–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- –ù–∞–ª–∏—á–∏–µ rate limiting middleware –≤ FastAPI
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç DDoS

---

## üéØ –ò—Ç–æ–≥–æ–≤—ã–π —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á

### –ö—Ä–∏—Ç–∏—á–Ω—ã–µ (–Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ):

1. ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —Ä–∞—Å—Å—ã–ª–æ–∫ —á–µ—Ä–µ–∑ Telegram –±–æ—Ç**
   - –§–∞–π–ª: `web/backend/app/api/broadcasts.py`
   - –§—É–Ω–∫—Ü–∏—è: `send_broadcast_task()`

2. ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—Ç–ø—Ä–∞–≤–∫—É –ª–∏—Å—Ç-–Ω–∞—Ä—è–¥–æ–≤ –º–∞—Å—Ç–µ—Ä–∞–º**
   - –§–∞–π–ª: `web/backend/app/tasks/notifications.py`
   - –î–æ–±–∞–≤–∏—Ç—å –≤: `web/backend/app/celery_app.py`

3. ‚úÖ **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –æ –Ω–æ–≤—ã—Ö –∑–∞–ø–∏—Å—è—Ö**
   - –§–∞–π–ª: `web/backend/app/tasks/notifications.py`
   - –î–æ–±–∞–≤–∏—Ç—å –≤: `web/backend/app/celery_app.py`

### –°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:

4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ `client_history`
5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ callback –∫–Ω–æ–ø–æ–∫ –≤ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è—Ö
6. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å rate limiting –¥–ª—è API

---

## üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

- **–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ:** ~95%
- **–¢—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏:** ~5%
- **–ö—Ä–∏—Ç–∏—á–Ω—ã—Ö –∑–∞–¥–∞—á:** 3
- **–°—Ä–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** 3

---

**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏:** 28 –¥–µ–∫–∞–±—Ä—è 2025  
**–í–µ—Ä—Å–∏—è —Å–∏—Å—Ç–µ–º—ã:** 1.0.0




