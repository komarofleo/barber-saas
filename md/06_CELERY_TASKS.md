# –≠—Ç–∞–ø 6: Celery –ó–∞–¥–∞—á–∏

**–ü—Ä–æ–¥–æ–ª–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 2 –¥–Ω—è  
**–°—Ç–∞—Ç—É—Å:** ‚è≥ –í –æ–∂–∏–¥–∞–Ω–∏–∏  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π

---

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

1. [–¶–µ–ª—å —ç—Ç–∞–ø–∞](#—Ü–µ–ª—å-—ç—Ç–∞–ø–∞)
2. [–ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è](#–ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è)
3. [–ü–æ–¥–∑–∞–¥–∞—á–∏](#–ø–æ–¥–∑–∞–¥–∞—á–∏)
4. [–ß–µ–∫-–ª–∏—Å—Ç —ç—Ç–∞–ø–∞](#—á–µ–∫-–ª–∏—Å—Ç-—ç—Ç–∞–ø–∞)
5. [–†–∏—Å–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏–µ](#—Ä–∏—Å–∫–∏-–∏-–∏—Ö-—Ä–µ—à–µ–Ω–∏–µ)

---

## üéØ –¶–µ–ª—å —ç—Ç–∞–ø–∞

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ–± –æ–ø–ª–∞—Ç–µ, –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–æ–∫ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook –æ—Ç –Æ–∫–∞—Å—Å—ã.

### –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 7 –¥–Ω–µ–π –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 3 –¥–Ω—è –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –≤ –¥–µ–Ω—å –æ–∫–æ–Ω—á–∞–Ω–∏—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∑–∞–ø–∏—Å–∏ –ø—Ä–∏ –Ω–µ–æ–ø–ª–∞—Ç–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ 7 –¥–Ω–µ–π
- –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook –æ—Ç –Æ–∫–∞—Å—Å—ã –≤ —Ñ–æ–Ω–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –ª–∏—Å—Ç-–Ω–∞—Ä—è–¥–æ–≤ –º–∞—Å—Ç–µ—Ä–∞–º

---

## üîß –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### –ü–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º —Ä–∞–±–æ—Ç—ã

- [ ] –≠—Ç–∞–ø 4 –∑–∞–≤–µ—Ä—à–µ–Ω (–ø—É–±–ª–∏—á–Ω—ã–µ API —Ä–∞–±–æ—Ç–∞—é—Ç)
- [ ] –≠—Ç–∞–ø 5 –∑–∞–≤–µ—Ä—à–µ–Ω (API —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∞ —Ä–∞–±–æ—Ç–∞—é—Ç)
- [ ] Celery –∏ Celery Beat –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [ ] Redis —Ä–∞–±–æ—Ç–∞–µ—Ç

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Python 3.11+ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- Celery 5.3+ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
- Redis 7+ —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ä–∞–±–æ—Ç—ã —Å —Ñ–æ–Ω–æ–≤—ã–º–∏ –∑–∞–¥–∞—á–∞–º–∏

---

## üìù –ü–æ–¥–∑–∞–¥–∞—á–∏

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 6.1: –°–æ–∑–¥–∞—Ç—å subscription_tasks.py

**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å —Å –∑–∞–¥–∞—á–∞–º–∏ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∞–º–∏.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª:
   ```
   web/backend/app/tasks/subscription_tasks.py
   ```

2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∑–∞–¥–∞—á–∏:
   ```python
   from celery import shared_task
   from datetime import date, datetime, timedelta
   from sqlalchemy.ext.asyncio import AsyncSession
   from sqlalchemy import select, and_
   import logging
   
   from app.database import get_session_with_schema
   from app.models.company import Company
   from app.models.subscription import Subscription
   from app.services.company_service import block_company_bookings, block_company_full
   
   logger = logging.getLogger(__name__)
   
   @shared_task
   def send_reminder_7_days_before():
       """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ 7 –¥–Ω–µ–π –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏"""
       asyncio.run(_send_reminders(days_before=7))
   
   @shared_task
   def send_reminder_3_days_before():
       """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ 3 –¥–Ω—è –¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏"""
       asyncio.run(_send_reminders(days_before=3))
   
   @shared_task
   def send_reminder_today():
       """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –≤ –¥–µ–Ω—å –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏"""
       asyncio.run(_send_reminders(days_before=0))
   
   @shared_task
   def check_overdue_subscriptions():
       """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏"""
       asyncio.run(_check_overdue())
   
   @shared_task
   def check_full_block_subscriptions():
       """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏–∏ —Å –ø—Ä–æ—Å—Ä–æ—á–∫–æ–π > 7 –¥–Ω–µ–π"""
       asyncio.run(_check_full_block())
   
   async def _send_reminders(days_before: int):
       """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è"""
       target_date = date.today() + timedelta(days=days_before)
       
       async for session in get_session_with_schema("public"):
           # –ò—â–µ–º –∫–æ–º–ø–∞–Ω–∏–∏ —Å –ø–æ–¥–ø–∏—Å–∫–æ–π, –∑–∞–∫–∞–Ω—á–∏–≤–∞—é—â–µ–π—Å—è —á–µ—Ä–µ–∑ days_before –¥–Ω–µ–π
           from sqlalchemy import func
           
           result = await session.execute(
               select(Company, Subscription.end_date, Subscription.end_date - target_date).join(
                   Subscription, Company.id == Subscription.company_id
               ).where(
                   Company.is_active == True,
                   Company.subscription_status == 'active',
                   Subscription.end_date == target_date
               )
           )
           companies_data = result.all()
           
           for company, end_date, days_left in companies_data:
               await _send_reminder_to_company(company, days_left)
       
       logger.info(f"–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –∫–æ–º–ø–∞–Ω–∏—è–º, —É –∫–æ—Ç–æ—Ä—ã—Ö –ø–æ–¥–ø–∏—Å–∫–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ {days_before} –¥–Ω–µ–π")
   
   async def _send_reminder_to_company(company, days_left):
       """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏"""
       # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º Telegram —Å–æ–æ–±—â–µ–Ω–∏–µ –∏–ª–∏ email
       # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É
       
       logger.info(f"–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –∫–æ–º–ø–∞–Ω–∏–∏ {company.name} (–¥–æ –æ–∫–æ–Ω—á–∞–Ω–∏—è: {days_left} –¥–Ω–µ–π)")
   
   async def _check_overdue():
       """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏"""
       today = date.today()
       
       async for session in get_session_with_schema("public"):
           # –ò—â–µ–º –∫–æ–º–ø–∞–Ω–∏–∏ —Å –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–æ–π
           result = await session.execute(
               select(Company).where(
                   Company.is_active == True,
                   Company.subscription_status == 'active',
                   Company.subscription_end_date < today
               )
           )
           companies = result.scalars().all()
           
           for company in companies:
               # –ë–ª–æ–∫–∏—Ä—É–µ–º —Ç–æ–ª—å–∫–æ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π
               await block_company_bookings(session, company.id)
               logger.warning(f"–ö–æ–º–ø–∞–Ω–∏—è {company.name} –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ (—Ç–æ–ª—å–∫–æ –∑–∞–ø–∏—Å—å)")
           
           await session.commit()
       
       logger.info(f"–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ {len(companies)} –∫–æ–º–ø–∞–Ω–∏–π —Å –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω–æ–π –ø–æ–¥–ø–∏—Å–∫–æ–π")
   
   async def _check_full_block():
       """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–æ–º–ø–∞–Ω–∏–∏"""
       today = date.today()
       seven_days_ago = today - timedelta(days=7)
       
       async for session in get_session_with_schema("public"):
           # –ò—â–µ–º –∫–æ–º–ø–∞–Ω–∏–∏ —Å –ø—Ä–æ—Å—Ä–æ—á–∫–æ–π –±–æ–ª–µ–µ 7 –¥–Ω–µ–π
           result = await session.execute(
               select(Company).where(
                   Company.is_active == True,
                   Company.subscription_end_date < seven_days_ago
               )
           )
           companies = result.scalars().all()
           
           for company in companies:
               # –ü–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞
               await block_company_full(session, company.id)
               logger.error(f"–ö–æ–º–ø–∞–Ω–∏—è {company.name} –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ (–ø—Ä–æ—Å—Ä–æ—á–∫–∞ > 7 –¥–Ω–µ–π)")
           
           await session.commit()
       
       logger.warning(f"–ü–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–æ {len(companies)} –∫–æ–º–ø–∞–Ω–∏–π")
   ```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- [ ] –§–∞–π–ª —Å–æ–∑–¥–∞–Ω
- [ ] –í—Å–µ –∑–∞–¥–∞—á–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- [ ] –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
- [ ] –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 6.2: –°–æ–∑–¥–∞—Ç—å payment_tasks.py

**–û–ø–∏—Å–∞–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å –º–æ–¥—É–ª—å —Å –∑–∞–¥–∞—á–∞–º–∏ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–µ–π.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª:
   ```
   web/backend/app/tasks/payment_tasks.py
   ```

2. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∑–∞–¥–∞—á–∏:
   ```python
   from celery import shared_task
   import logging
   import asyncio
   
   from app.database import get_session_with_schema
   from app.models.payment import Payment
   from app.services.subscription_service import create_subscription
   
   logger = logging.getLogger(__name__)
   
   @shared_task
   def process_yookassa_webhook(payment_id: str, status: str):
       """–û–±—Ä–∞–±–æ—Ç–∫–∞ webhook –æ—Ç –Æ–∫–∞—Å—Å—ã –≤ —Ñ–æ–Ω–µ"""
       try:
           asyncio.run(_process_webhook(payment_id, status))
       except Exception as e:
           logger.error(f"–û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook: {e}", exc_info=True)
   
   async def _process_webhook(payment_id: str, status: str):
       """–û–±—Ä–∞–±–æ—Ç–∫–∞ webhook"""
       from app.services.payment_service import update_payment
       
       async for session in get_session_with_schema("public"):
           # –ò—â–µ–º –ø–ª–∞—Ç–µ–∂
           result = await session.execute(
               select(Payment).where(Payment.yookassa_payment_id == payment_id)
           )
           payment = result.scalar_one_or_none()
           
           if not payment:
               logger.error(f"–ü–ª–∞—Ç–µ–∂ {payment_id} –Ω–µ –Ω–∞–π–¥–µ–Ω")
               return
           
           # –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å
           await update_payment(session, payment.id, {
               "yookassa_payment_status": status,
               "status": "completed" if status == "succeeded" else "failed"
           })
           
           # –ï—Å–ª–∏ –æ–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–∞
           if status == "succeeded":
               # –°–æ–∑–¥–∞–µ–º –ø–æ–¥–ø–∏—Å–∫—É
               subscription_id = payment.subscription_id
               company_id = payment.company_id
               plan_id = payment.metadata.get("plan_id")
               
               await create_subscription(session, {
                   "company_id": company_id,
                   "plan_id": plan_id,
                   "start_date": date.today(),
                   "end_date": date.today() + timedelta(days=30),
                   "status": "active",
                   "payment_method": "yookassa",
                   "yookassa_payment_id": payment_id
               })
               
               # –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –∫–æ–º–ø–∞–Ω–∏—é
               from app.models.company import Company
               result = await session.execute(
                   select(Company).where(Company.id == company_id)
               )
               company = result.scalar_one_or_none()
               
               if company:
                   company.is_active = True
                   company.subscription_status = "active"
                   company.can_create_bookings = True
                   await session.commit()
                   
                   # –°–æ–∑–¥–∞–µ–º —Å—Ö–µ–º—É –∏ –ø—Ä–∏–º–µ–Ω—è–µ–º –º–∏–≥—Ä–∞—Ü–∏–∏ (–≤ —Ñ–æ–Ω–µ)
                   # TODO: –í—ã–∑–≤–∞—Ç—å –∑–∞–¥–∞—á—É —Å–æ–∑–¥–∞–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
                   
               logger.info(f"–ö–æ–º–ø–∞–Ω–∏—è {company_id} –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–ø–ª–∞—Ç—ã")
           
           await session.commit()
           
       logger.info(f"Webhook {payment_id} –æ–±—Ä–∞–±–æ—Ç–∞–Ω, —Å—Ç–∞—Ç—É—Å: {status}")
   ```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- [ ] –§–∞–π–ª —Å–æ–∑–¥–∞–Ω
- [ ] –ó–∞–¥–∞—á–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã
- [ ] Webhook –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è
- [ ] –ü–æ–¥–ø–∏—Å–∫–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è
- [ ] –ö–æ–º–ø–∞–Ω–∏—è –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 6.3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Celery Beat

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞—á.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –û–±–Ω–æ–≤–∏—Ç—å web/backend/app/celery_app.py:
   ```python
   from celery.schedules import crontab
   
   from app.tasks.subscription_tasks import (
       send_reminder_7_days_before,
       send_reminder_3_days_before,
       send_reminder_today,
       check_overdue_subscriptions,
       check_full_block_subscriptions
   )
   
   # –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞—á
   app.conf.beat_schedule = {
       # –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –æ–± –æ–ø–ª–∞—Ç–µ
       'send-reminder-7-days': {
           'task': 'app.tasks.subscription_tasks.send_reminder_7_days_before',
           'schedule': crontab(hour=10, minute=0),  # –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 10:00
       },
       'send-reminder-3-days': {
           'task': 'app.tasks.subscription_tasks.send_reminder_3_days_before',
           'schedule': crontab(hour=10, minute=0),  # –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 10:00
       },
       'send-reminder-today': {
           'task': 'app.tasks.subscription_tasks.send_reminder_today',
           'schedule': crontab(hour=9, minute=0),   # –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 09:00
       },
       
       # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–æ–∫
       'check-overdue-subscriptions': {
           'task': 'app.tasks.subscription_tasks.check_overdue_subscriptions',
           'schedule': crontab(hour=11, minute=0),  # –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 11:00
       },
       'check-full-block-subscriptions': {
           'task': 'app.tasks.subscription_tasks.check_full_block_subscriptions',
           'schedule': crontab(hour=12, minute=0),  # –ö–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 12:00
       },
   }
   
   logger.info("Celery Beat –Ω–∞—Å—Ç—Ä–æ–µ–Ω –¥–ª—è –∑–∞–¥–∞—á –ø–æ–¥–ø–∏—Å–æ–∫")
   ```

2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:
   ```bash
   docker compose exec web celery -A app.celery inspect beat
   ```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- [ ] Celery Beat –Ω–∞—Å—Ç—Ä–æ–µ–Ω
- [ ] –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–æ
- [ ] –ó–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é
- [ ] –õ–æ–≥–∏ Celery —Ä–∞–±–æ—Ç–∞—é—Ç

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 6.4: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–¥–∞—á–∏

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–¥–∞—á.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:
   ```
   scripts/test_celery_tasks.py
   ```

2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã:
   ```python
   import asyncio
   from datetime import date, timedelta
   
   from app.tasks.subscription_tasks import (
       send_reminder_7_days_before,
       send_reminder_3_days_before,
       send_reminder_today,
       check_overdue_subscriptions,
       check_full_block_subscriptions
   )
   from app.database import get_session_with_schema
   
   async def test_reminders():
       """–¢–µ—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π"""
       print("=== –¢–µ—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π ===\n")
       
       # –¢–µ—Å—Ç 1: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 7 –¥–Ω–µ–π
       print("1. –¢–µ—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –∑–∞ 7 –¥–Ω–µ–π...")
       await send_reminder_7_days_before.apply_async()
       print("   ‚úÖ –ó–∞–¥–∞—á–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å\n")
       
       # –¢–µ—Å—Ç 2: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 3 –¥–Ω—è
       print("2. –¢–µ—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –∑–∞ 3 –¥–Ω—è...")
       await send_reminder_3_days_before.apply_async()
       print("   ‚úÖ –ó–∞–¥–∞—á–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å\n")
       
       # –¢–µ—Å—Ç 3: –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —Å–µ–≥–æ–¥–Ω—è
       print("3. –¢–µ—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π —Å–µ–≥–æ–¥–Ω—è...")
       await send_reminder_today.apply_async()
       print("   ‚úÖ –ó–∞–¥–∞—á–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å\n")
       
       print("=== –¢–µ—Å—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω ===\n")
   
   async def test_blocking():
       """–¢–µ—Å—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫"""
       print("=== –¢–µ—Å—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ ===\n")
       
       # –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫
       print("1. –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫...")
       await check_overdue_subscriptions.apply_async()
       print("   ‚úÖ –ó–∞–¥–∞—á–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å\n")
       
       # –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫
       print("2. –¢–µ—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª–Ω—ã—Ö –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫...")
       await check_full_block_subscriptions.apply_async()
       print("   ‚úÖ –ó–∞–¥–∞—á–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å\n")
       
       print("=== –¢–µ—Å—Ç –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –∑–∞–≤–µ—Ä—à–µ–Ω ===\n")
   
   async def test_payment_webhook():
       """–¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook"""
       print("=== –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook ===\n")
       
       print("1. –¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ–≥–æ webhook...")
       await process_yookassa_webhook("test_payment_id", "succeeded")
       print("   ‚úÖ –ó–∞–¥–∞—á–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å\n")
       
       print("2. –¢–µ—Å—Ç –Ω–µ—É–¥–∞—á–Ω–æ–≥–æ webhook...")
       await process_yookassa_webhook("test_payment_id_2", "canceled")
       print("   ‚úÖ –ó–∞–¥–∞—á–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞ –≤ –æ—á–µ—Ä–µ–¥—å\n")
       
       print("=== –¢–µ—Å—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ webhook –∑–∞–≤–µ—Ä—à–µ–Ω ===\n")
   
   async def test_tasks():
       """–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã"""
       await test_reminders()
       await test_blocking()
       await test_payment_webhook()
   
   if __name__ == "__main__":
       asyncio.run(test_tasks())
   ```

3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã:
   ```bash
   docker compose exec web python scripts/test_celery_tasks.py
   ```

4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Celery worker:
   ```bash
   docker compose logs celery-worker -f
   ```

5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Celery Beat:
   ```bash
   docker compose logs celery-beat -f
   ```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã
- [ ] –ó–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤ –æ—á–µ—Ä–µ–¥–∏
- [ ] Celery worker –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∑–∞–¥–∞—á–∏
- [ ] –õ–æ–≥–∏ Celery –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 6.5: –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–û–ø–∏—Å–∞–Ω–∏–µ:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É Telegram —Å–æ–æ–±—â–µ–Ω–∏–π –∏ email.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –û–±–Ω–æ–≤–∏—Ç—å bot/config.py:
   ```python
   # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
   NOTIFICATION_BOT_TOKEN = os.getenv("NOTIFICATION_BOT_TOKEN", BOT_TOKEN)
   ```

2. –°–æ–∑–¥–∞—Ç—å —Å–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:
   ```python
   web/backend/app/services/notification_service.py
   ```

3. –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏:
   ```python
   import aiohttp
   import logging
   from typing import Optional
   
   from bot.config import NOTIFICATION_BOT_TOKEN
   
   logger = logging.getLogger(__name__)
   
   async def send_telegram_message(telegram_id: int, text: str):
       """–û—Ç–ø—Ä–∞–≤–∏—Ç—å Telegram —Å–æ–æ–±—â–µ–Ω–∏–µ"""
       url = f"https://api.telegram.org/bot{NOTIFICATION_BOT_TOKEN}/sendMessage"
       payload = {
           "chat_id": telegram_id,
           "text": text,
           "parse_mode": "HTML"
       }
       
       try:
           async with aiohttp.ClientSession() as session:
               async with session.post(url, json=payload) as response:
                   data = await response.json()
                   
                   if not data.get("ok"):
                       logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏—è: {data}")
                       return False
                   
                   logger.info(f"–°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ: telegram_id={telegram_id}")
                   return True
       
       except Exception as e:
           logger.error(f"–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ Telegram —Å–æ–æ–±—â–µ–Ω–∏—è: {e}", exc_info=True)
           return False
   
   async def send_email_notification(email: str, subject: str, body: str):
       """–û—Ç–ø—Ä–∞–≤–∏—Ç—å email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"""
       # TODO: –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —á–µ—Ä–µ–∑ SMTP –∏–ª–∏ —Å–µ—Ä–≤–∏—Å —Ä–∞—Å—Å—ã–ª–∫–∏
       logger.info(f"Email –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω: {email}")
       return True
   ```

4. –û–±–Ω–æ–≤–∏—Ç—å –∑–∞–¥–∞—á–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞:
   ```python
   from app.services.notification_service import send_telegram_message, send_email_notification
   
   async def _send_reminder_to_company(company, days_left):
       """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∫–æ–º–ø–∞–Ω–∏–∏"""
       # –ü–æ–ª—É—á–∞–µ–º ID –∞–¥–º–∏–Ω–∞ –∫–æ–º–ø–∞–Ω–∏–∏
       admin_telegram_id = get_company_admin_telegram_id(company.id)
       
       if admin_telegram_id:
           days_text = "—Å–µ–≥–æ–¥–Ω—è" if days_left == 0 else f"—á–µ—Ä–µ–∑ {days_left} –¥–Ω–µ–π"
           
           message = f"""
           ‚ö†Ô∏è –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ–ø–ª–∞—Ç–µ –ø–æ–¥–ø–∏—Å–∫–∏!
           
           –ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ!
           
           –í–∞—à–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –∏—Å—Ç–µ–∫–∞–µ—Ç {days_text}.
           
           –î–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å–∏—Å—Ç–µ–º—ã, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ–¥–ª–∏—Ç–µ –ø–æ–¥–ø–∏—Å–∫—É.
           
           –° —É–≤–∞–∂–µ–Ω–∏–µ–º,
           AutoService SaaS
           """
           
           await send_telegram_message(admin_telegram_id, message)
       
       # –ï—Å–ª–∏ –µ—Å—Ç—å email, –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏ email
       if company.email:
           subject = f"–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ–± –æ–ø–ª–∞—Ç–µ –ø–æ–¥–ø–∏—Å–∫–∏"
           await send_email_notification(company.email, subject, message)
   ```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- [ ] –°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å–æ–∑–¥–∞–Ω
- [ ] Telegram —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
- [ ] Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç (–µ—Å–ª–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã)
- [ ] –ó–∞–¥–∞—á–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å–µ—Ä–≤–∏—Å
- [ ] –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

---

### –ü–æ–¥–∑–∞–¥–∞—á–∞ 6.6: –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–û–ø–∏—Å–∞–Ω–∏–µ:** –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–ø—Ä–∞–≤–∫—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π.

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**

1. –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç:
   ```
   scripts/test_notifications.py
   ```

2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ç–µ—Å—Ç—ã:
   ```python
   import asyncio
   from app.services.notification_service import send_telegram_message
   
   async def test_telegram_notification():
       """–¢–µ—Å—Ç –æ—Ç–ø—Ä–∞–≤–∫–∏ Telegram —Å–æ–æ–±—â–µ–Ω–∏—è"""
       print("=== –¢–µ—Å—Ç Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π ===\n")
       
       # –ò—Å–ø–æ–ª—å–∑—É–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π Telegram ID
       test_telegram_id = 329621295  # –ó–∞–º–µ–Ω–∏—Ç—å –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã–π
       
       message = "üß™ –¢–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ—Ç Celery –∑–∞–¥–∞—á–∏!"
       
       print("1. –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...")
       success = await send_telegram_message(test_telegram_id, message)
       
       if success:
           print("   ‚úÖ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ\n")
       else:
           print("   ‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏\n")
       
       print("=== –¢–µ—Å—Ç Telegram —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –∑–∞–≤–µ—Ä—à–µ–Ω ===\n")
   
   async def test_tasks():
       """–ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã"""
       await test_telegram_notification()
   
   if __name__ == "__main__":
       asyncio.run(test_tasks())
   ```

3. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç:
   ```bash
   docker compose exec web python scripts/test_notifications.py
   ```

**–ö—Ä–∏—Ç–µ—Ä–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω
- [ ] –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –ª–æ–≥–∞—Ö
- [ ] –¢–µ—Å—Ç —É—Å–ø–µ—à–µ–Ω

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç —ç—Ç–∞–ø–∞

### –ó–∞–¥–∞—á–∏ –ø–æ–¥–ø–∏—Å–æ–∫

- [ ] subscription_tasks.py —Å–æ–∑–¥–∞–Ω
- [ ] –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 7 –¥–Ω–µ–π —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è –∑–∞ 3 –¥–Ω—è —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è —Å–µ–≥–æ–¥–Ω—è —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ—Å—Ä–æ—á–µ–Ω–Ω—ã—Ö –ø–æ–¥–ø–∏—Å–æ–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–æ–ª–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ó–∞–¥–∞—á–∏ –ø–ª–∞—Ç–µ–∂–µ–π

- [ ] payment_tasks.py —Å–æ–∑–¥–∞–Ω
- [ ] –û–±—Ä–∞–±–æ—Ç–∫–∞ webhook —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –ü–æ–¥–ø–∏—Å–∫–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è
- [ ] –ö–æ–º–ø–∞–Ω–∏—è –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è
- [ ] –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è

### Celery Beat

- [ ] –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [ ] –ó–∞–¥–∞—á–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –≤–æ–≤—Ä–µ–º—è
- [ ] –õ–æ–≥–∏ Celery Beat –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- [ ] –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–¥–∞—á

### –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

- [ ] –°–µ—Ä–≤–∏—Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π —Å–æ–∑–¥–∞–Ω
- [ ] Telegram —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
- [ ] Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] –û—à–∏–±–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- [ ] –¢–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã —Å–æ–∑–¥–∞–Ω—ã
- [ ] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ–π–¥–µ–Ω—ã
- [ ] Celery worker –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
- [ ] –õ–æ–≥–∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫

---

## ‚ö†Ô∏è –†–∏—Å–∫–∏ –∏ –∏—Ö —Ä–µ—à–µ–Ω–∏–µ

### –†–∏—Å–∫ 1: –ó–∞–¥–∞—á–∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –ø–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –°—Ä–µ–¥–Ω—è—è  
**–í–ª–∏—è–Ω–∏–µ:** –í—ã—Å–æ–∫–æ–µ

**–ú–µ—Ä—ã –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã Celery Beat
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–¥–∞—á
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏:**
- –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –∑–∞–¥–∞—á
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Celery Beat
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

---

### –†–∏—Å–∫ 2: –û—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è  
**–í–ª–∏—è–Ω–∏–µ:** –°—Ä–µ–¥–Ω–µ–µ

**–ú–µ—Ä—ã –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:**
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –æ—à–∏–±–æ–∫
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫
- –†–µ–∑–µ—Ä–≤–Ω—ã–π —Å–ø–æ—Å–æ–± —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–†–µ—à–µ–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏:**
- –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞
- –û—Ç–ø—Ä–∞–≤–∫–∞ —á–µ—Ä–µ–∑ email
- –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏

---

### –†–∏—Å–∫ 3: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á

**–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å:** –ù–∏–∑–∫–∞—è  
**–í–ª–∏—è–Ω–∏–µ:** –ù–∏–∑–∫–æ–µ

**–ú–µ—Ä—ã –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è:**
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∏–º–µ–Ω–∞ –∑–∞–¥–∞—á
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –ø–µ—Ä–µ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –∑–∞–ø—É—Å–∫–æ–≤

**–†–µ—à–µ–Ω–∏–µ –ø—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∑–∞–¥–∞—á
- –û—á–∏—Å—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏
- –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Celery

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Celery worker:
   ```bash
   docker compose logs celery-worker -f
   ```

2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Celery Beat:
   ```bash
   docker compose logs celery-beat -f
   ```

3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á:
   ```bash
   docker compose exec web celery -A app.celery inspect active
   ```

4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏:
   ```bash
   docker compose exec web celery -A app.celery inspect scheduled
   ```

5. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å Redis:
   ```bash
   docker compose exec redis redis-cli keys "celery*"
   ```

---

**–≠—Ç–∞–ø 6 –∑–∞–≤–µ—Ä—à–µ–Ω:** [ ]  
**–î–∞—Ç–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:** _________  
**–ü—Ä–∏–º–µ—á–∞–Ω–∏—è:** _________________

