# 💇 Barber - Система бронирования для салона красоты

Полнофункциональная система управления записями в салоне красоты с Telegram-ботом и веб-админ панелью.

---

## 📋 Содержание документации

- **[README.md](README.md)** - Этот файл (обзор проекта)
- **[DATABASE.md](DATABASE.md)** - Структура базы данных
- **[API.md](API.md)** - Описание API endpoints
- **[USER_FLOWS.md](USER_FLOWS.md)** - Пользовательские сценарии
- **[DEPLOYMENT.md](DEPLOYMENT.md)** - Руководство по развертыванию
- **[CONFIGURATION.md](CONFIGURATION.md)** - Настройка системы

---

## 🎯 О проекте

**Barber** - это комплексное решение для автоматизации записи клиентов в салон красоты.

### Проблемы которые решает система

| Было ❌ | Стало ✅ |
|---------|----------|
| Путаница с записями в Excel и мессенджерах | Централизованная система с автоматическими уведомлениями |
| Неявки клиентов без предупреждения | Автоматические напоминания за день и за час до записи |
| Потеря заявок из разных каналов | Единая точка входа через Telegram бот |
| Ручное распределение мастеров и рабочих мест | Автоматическое или ручное назначение с учетом загрузки |

### Ключевые метрики салона красоты

- **6-10 мастеров** одновременно
- **5-7 рабочих мест** для обслуживания
- **5-10 записей в день** (средняя нагрузка)
- **График работы:** 9:00 - 18:00 без выходных (7 дней в неделю)
- **Шаг записи:** 30 минут
- **Длительность услуг:** 30 минут (1 слот) или 60 минут (2 слота)

---

## ✨ Основные возможности

### 🤖 Telegram Бот

#### Для клиентов
- 📅 **Запись на услугу** с выбором даты и времени
- 📋 **Мои записи** с историей
- 📊 **История обслуживания** авто
- 🎟️ **Промокоды** и 🎉 **Акции**
- 🔔 **Уведомления** (за день, за час, изменение статуса)

#### Для администраторов (`/admin`)
- ✅ **Подтверждение записей** с назначением мастера и рабочего места
- ✏️ **Управление записями** (статусы, переносы, отмены)
- 💰 **Внесение суммы** и отметка оплаты
- 📊 **Статистика** (записи, выручка, неявки)
- 🎟️ **Промокоды** и 🎉 **Акции**
- 📢 **Рассылки** клиентам

#### Для мастеров (`/master`)
- 📋 **Лист-наряд** на день с деталями записей
- ✔️ **Завершение записи** (изменение статуса)
- 🔔 **Уведомления** о новых/измененных записях

### 🌐 Веб-админ панель

#### Главные возможности
- 📅 **Календарь** (3 вида: месяц/неделя/день) - **ГЛАВНАЯ ФИЧА**
- 📋 **Таблица записей** с фильтрами и поиском
- 🗂️ **Справочники** (услуги, мастера, рабочие места, клиенты)
- 🚫 **Блокировки** (дат, мастеров, рабочих мест, услуг)
- 📊 **Детальная статистика** с графиками
- 🎟️ **Промокоды** и 🎉 **Акции**
- 📢 **Рассылки** с выбором аудитории
- 📤 **Экспорт** данных в Excel

### Статусы записей

```
🆕 Новая         - создана клиентом, ждет подтверждения
✅ Подтверждена  - подтверждена администратором
✔️ Выполнена     - работа завершена (ФИНАЛЬНЫЙ СТАТУС)
❌ Отменена      - отменена клиентом или админом
⚠️ Не явился     - клиент не приехал (no-show)
📍 Приоритет     - срочная запись
```

---

## 🏗️ Архитектура

### Компоненты системы

```
┌─────────────────────────────────────────────────────────┐
│                     ПОЛЬЗОВАТЕЛИ                         │
├──────────────┬──────────────┬──────────────┬────────────┤
│   Клиенты    │  Администр.  │   Мастера    │  Веб-админ │
│  (Telegram)  │  (Telegram)  │  (Telegram)  │  (Browser) │
└──────┬───────┴──────┬───────┴──────┬───────┴──────┬─────┘
       │              │              │              │
       └──────────────┴──────────────┴──────────────┘
                      │
              ┌───────▼───────┐
              │  Telegram Bot │
              │   (aiogram)   │
              └───────┬───────┘
                      │
       ┌──────────────┼──────────────┐
       │              │              │
┌──────▼──────┐ ┌─────▼─────┐ ┌─────▼─────┐
│  PostgreSQL │ │   Redis   │ │  Backend  │
│   (БД)      │ │  (Кеш)    │ │ (FastAPI) │
└─────────────┘ └───────────┘ └─────┬─────┘
                                     │
                              ┌──────▼──────┐
                              │  Frontend   │
                              │   (React)   │
                              └─────────────┘
```

### Технологический стек

**Backend:**
- FastAPI (Python 3.11+)
- PostgreSQL 15 + SQLAlchemy 2.0 (async)
- Redis 7 (кеш + Celery broker)
- Celery + Celery Beat (периодические задачи)
- Alembic (миграции БД)

**Telegram Bot:**
- aiogram 3.x
- FSM для диалогов
- PostgreSQL (asyncpg)

**Frontend:**
- React 18 + TypeScript
- Material-UI (MUI v5)
- React Query (state management)
- React Router v6
- react-big-calendar (календарь)
- Recharts (графики)
- Vite (build tool)

**DevOps:**
- Docker + Docker Compose
- Nginx (для frontend)

---

## 📁 Структура проекта

```
barber/
├── bot/                    # Telegram бот
│   ├── handlers/
│   │   ├── client/        # Клиенты
│   │   ├── admin/         # Администраторы
│   │   └── master/        # Мастера
│   ├── keyboards/         # Клавиатуры
│   ├── database/          # Модели БД и CRUD
│   ├── services/          # Бизнес-логика
│   ├── middlewares/       # Middleware
│   ├── states/            # FSM состояния
│   └── utils/             # Утилиты
│
├── web/                   # Веб-панель
│   ├── backend/           # FastAPI Backend
│   │   ├── app/
│   │   │   ├── api/       # API endpoints
│   │   │   ├── schemas/   # Pydantic схемы
│   │   │   ├── services/  # Бизнес-логика
│   │   │   └── tasks/     # Celery tasks
│   │   └── alembic/       # Миграции БД
│   │
│   └── frontend/          # React Frontend
│       ├── src/
│       │   ├── pages/     # Страницы
│       │   ├── components/# Компоненты
│       │   ├── api/       # API клиент
│       │   └── hooks/     # Custom hooks
│       └── nginx.conf
│
├── shared/                # Общий код
│   └── database/         # Модели БД
│
├── docker-compose.yml
├── Dockerfile
├── .env.example
├── requirements.txt
└── README.md
```

---

## 🚀 Быстрый старт

### Требования

- Docker 20.10+
- Docker Compose 2.0+
- Минимум: 2GB RAM, 10GB диск
- Порты: 3000, 8000, 5433, 6380

### Установка

#### 1. Клонирование проекта

```bash
git clone https://github.com/your-repo/barber.git
cd barber
```

#### 2. Настройка переменных окружения

```bash
cp .env.example .env
nano .env
```

**Минимальные обязательные переменные:**

```env
# Telegram Bot
BOT_TOKEN=your_bot_token_here
ADMIN_IDS=329621295

# Database
DB_PASSWORD=your_strong_password

# Web
WEB_SECRET_KEY=your-32-char-secret-key
WEB_CORS_ORIGINS=http://your-server-ip:3000
```

Полный список переменных смотрите в `CONFIGURATION.md`

#### 3. Запуск

```bash
# Сборка образов
docker-compose build

# Запуск всех сервисов
docker-compose up -d

# Проверка статуса
docker-compose ps
```

#### 4. Инициализация БД

```bash
# Применение миграций
docker-compose exec web alembic upgrade head

# Создание первого администратора
docker-compose exec web python scripts/create_admin.py --telegram-id 329621295
```

#### 5. Проверка

```bash
# Бот
docker-compose logs bot | tail -20

# Backend
curl http://localhost:8000/api/health

# Frontend
curl http://localhost:3000
```

### Доступ

- **Веб-панель:** http://your-server-ip:3000
  - Username: Telegram ID
  - Password: Telegram ID
- **API Docs:** http://your-server-ip:8000/docs
- **Telegram бот:** @your_bot_name

---

## 📚 Документация

### Для разработчиков

- **[DATABASE.md](DATABASE.md)** - Структура БД, таблицы, индексы
- **[API.md](API.md)** - Все API endpoints с примерами
- **[USER_FLOWS.md](USER_FLOWS.md)** - Сценарии использования
- **[ARCHITECTURE.md](ARCHITECTURE.md)** - Детальная архитектура

### Для администраторов

- **[DEPLOYMENT.md](DEPLOYMENT.md)** - Развертывание на production
- **[CONFIGURATION.md](CONFIGURATION.md)** - Настройка системы
- **[BACKUP.md](BACKUP.md)** - Резервное копирование
- **[TROUBLESHOOTING.md](TROUBLESHOOTING.md)** - Решение проблем

### Для пользователей

- **[USER_MANUAL_CLIENT.md](USER_MANUAL_CLIENT.md)** - Инструкция для клиентов
- **[USER_MANUAL_ADMIN.md](USER_MANUAL_ADMIN.md)** - Инструкция для администраторов
- **[USER_MANUAL_MASTER.md](USER_MANUAL_MASTER.md)** - Инструкция для мастеров
- **[WEB_ADMIN_MANUAL.md](WEB_ADMIN_MANUAL.md)** - Инструкция по веб-панели

---

## 🔧 Решение проблем

### Бот не запускается

```bash
docker-compose logs bot | grep -i error
docker-compose restart bot
```

### Веб-панель не открывается

```bash
docker-compose ps
docker-compose logs web-frontend
docker-compose logs web
```

### База данных недоступна

```bash
docker-compose ps postgres
docker exec barber_postgres pg_isready -U barber_user
```

Подробнее: **[TROUBLESHOOTING.md](TROUBLESHOOTING.md)**

---

## 📊 Roadmap развития

### Version 1.0.0 (Текущая) ✅
- Telegram бот (клиенты, админы, мастера)
- Веб-админ панель
- Система бронирования
- Календарь (3 вида)
- Уведомления
- Промокоды и акции
- Статистика и экспорт

### Version 1.1.0 (Планируется)
- Интеграция с платежными системами (онлайн-оплата)
- SMS уведомления (резерв для Telegram)
- Мобильное приложение для мастеров
- Расширенная аналитика (AI insights)
- Интеграция с 1С

### Version 1.2.0 (В разработке)
- CRM функционал (лиды, воронка продаж)
- Программа лояльности (баллы, бонусы)
- Автоматические рекомендации услуг по пробегу
- Интеграция с складом (запчасти)

---

## 🔐 Безопасность

- JWT аутентификация для веб-панели
- Переменные окружения для секретов
- Изоляция контейнеров через Docker network
- Валидация входных данных (Pydantic)
- CORS настройки для API
- Rate limiting для защиты от DDoS

---

## 🤝 Contributing

Проект разработан для управления салонами красоты.

---

## 📞 Поддержка

При возникновении проблем:
1. Проверьте логи: `docker-compose logs -f`
2. Обратитесь к документации в папке `docs/`
3. Проверьте конфигурацию: `docker-compose config`

---

## 📄 Лицензия

Проект разработан для внутреннего использования.

---

## 📝 Changelog

### [1.0.0] - 2025-12-27
#### Added
- Первый релиз системы
- Telegram бот с тремя ролями (клиент, админ, мастер)
- Веб-админ панель с календарем
- Система бронирования с автоматическим назначением
- Уведомления (Celery + Celery Beat)
- Промокоды и акции
- Детальная статистика
- Экспорт данных в Excel
- Рассылки с выбором аудитории
- Блокировки (дат, мастеров, рабочих мест, услуг)
- История обслуживания клиентов

---

**Версия:** 1.0.0  
**Дата:** 27 декабря 2025  
**Автор:** Claude (Anthropic)  
**Заказчик:** Barber SaaS  
**Контакт:** support@barber-saas.com