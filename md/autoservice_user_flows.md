# ⚠️ УСТАРЕВШИЙ ДОКУМЕНТ (legacy)
Этот файл содержит сценарии старой версии (AutoService) и включает автосервисные шаги (ввод “марки авто”, “лист-наряд” и т.п.).

**Актуальные сценарии для Barber SaaS:**
- `md/USER_GUIDE.md`
- `md/ADMIN_GUIDE.md`
- `md/TESTING_PLAN.md`
- `tasks.md`

---

# 🔄 USER FLOWS - Пользовательские сценарии

Детальное описание сценариев взаимодействия пользователей с системой Barber.

---

## 📋 Содержание

1. [Клиент - Создание записи](#клиент---создание-записи)
2. [Администратор - Подтверждение записи](#администратор---подтверждение-записи)
3. [Мастер - Работа с лист-нарядом](#мастер---работа-с-лист-нарядом)
4. [Веб-панель - Управление календарем](#веб-панель---управление-календарем)
5. [Система - Автоматические уведомления](#система---автоматические-уведомления)

---

## 👤 Клиент - Создание записи

### Сценарий: Первый визит клиента

```
┌─────────────────────────────────────────────────────────┐
│                    START                                │
└─────────────────────┬───────────────────────────────────┘
                      │
                      ▼
            ┌─────────────────┐
            │   /start в боте │
            └────────┬────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │  Бот: "Добро пожало- │
          │  вать! Для начала    │
          │  введите ФИО"        │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Клиент вводит ФИО:   │
          │ "Петров Андрей Анат."│
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │  Бот: "Введите       │
          │  номер телефона"     │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Клиент:              │
          │ "+79991234567"       │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ БД: INSERT INTO      │
          │ users, clients       │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │  Бот: "Регистрация   │
          │  завершена!"         │
          │  [Главное меню]      │
          └──────────┬───────────┘
                     │
                     ▼
            ┌────────────────┐
            │  Главное меню: │
            │  📅 Записаться │
            │  📋 Мои записи │
            │  👤 Профиль    │
            │  ℹ️ О нас      │
            └────────┬───────┘
                     │
                     ▼
                   [END]
```

---

### Сценарий: Создание записи

```
┌─────────────────────────────────────────────────────────┐
│              Клиент нажимает "📅 Записаться"            │
└─────────────────────┬───────────────────────────────────┘
                      │
                      ▼
            ┌─────────────────┐
            │ API: GET        │
            │ /services       │
            │ ?is_active=true │
            └────────┬────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │  Бот показывает      │
          │  список услуг:       │
          │                      │
          │  🛠️ ТО - 3000₽      │
          │     60 минут         │
          │                      │
          │  🔧 Диагностика      │
          │     1500₽ 30 мин     │
          │                      │
          │  🎉 Шиномонтаж       │
          │     2500₽ → 2000₽   │
          │     (Акция -20%)     │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Клиент выбирает:     │
          │ "🛠️ ТО"             │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ API: GET             │
          │ /timeslots/available │
          │ ?date=2025-12-27     │
          │ &service_id=1        │
          └──────────┬───────────┘
                     │
        ┌────────────┴────────────┐
        │                         │
        ▼                         ▼
   [Система      [Система проверяет
    генерирует    блокировки:
    слоты]        blocked_slots]
        │                         │
        └────────────┬────────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │  Бот показывает      │
          │  календарь:          │
          │                      │
          │  Декабрь 2025        │
          │  Пн Вт Ср Чт Пт Сб Вс│
          │  22 23 24 25 26 27 28│
          │  ✅ ✅ ❌ ✅ ✅ ✅ ❌│
          │                      │
          │  (❌ = недоступно)   │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Клиент выбирает:     │
          │ "27 декабря"         │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │  Бот показывает      │
          │  свободные слоты:    │
          │                      │
          │  ✅ 09:00 - 10:00    │
          │  ✅ 09:30 - 10:30    │
          │  ❌ 10:00 - 11:00    │
          │  ✅ 10:30 - 11:30    │
          │  ...                 │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Клиент выбирает:     │
          │ "09:00"              │
          └──────────┬───────────┘
                     │
            ┌────────┴────────┐
            │                 │
            ▼                 ▼
     [Первая запись?]   [Есть данные авто?]
            │                 │
            ▼ Да              ▼ Нет
    ┌──────────────┐   ┌──────────────┐
    │ Бот: "Введите│   │ Бот: "Введите│
    │ марку авто"  │   │ марку авто"  │
    └──────┬───────┘   └──────┬───────┘
           │                  │
           ▼                  ▼
    ┌──────────────┐   ┌──────────────┐
    │ Клиент: "BMW"│   │ Клиент: "BMW"│
    └──────┬───────┘   └──────┬───────┘
           │                  │
           ▼                  ▼
    ┌──────────────┐   ┌──────────────┐
    │ Бот: "Введите│   │ Бот: "Модель"│
    │ модель"      │   │              │
    └──────┬───────┘   └──────┬───────┘
           │                  │
           ▼                  ▼
    ┌──────────────┐   ┌──────────────┐
    │ Клиент: "X5" │   │ Клиент: "X5" │
    └──────┬───────┘   └──────┬───────┘
           │                  │
           ▼                  ▼
    ┌──────────────┐   ┌──────────────┐
    │ Бот: "Госномер"  │ Бот: "Госномер"│
    └──────┬───────┘   └──────┬───────┘
           │                  │
           ▼                  ▼
    ┌──────────────────┐
    │ Клиент: "А123BC77"│
    └──────┬───────────┘
           │
           └───────────┬──────────────┘
                       │
                       ▼
            ┌──────────────────┐
            │ БД: UPDATE       │
            │ clients SET      │
            │ car_brand, ...   │
            └──────┬───────────┘
                   │
                   ▼
          ┌──────────────────────┐
          │  Бот: "Есть промокод?│
          │  🎟️ Ввести промокод │
          │  ➡️ Продолжить      │
          └──────────┬───────────┘
                     │
            ┌────────┴─────────┐
            │                  │
            ▼ Промокод         ▼ Продолжить
    ┌──────────────┐    ┌──────────────┐
    │ Клиент вводит│    │ Переход к    │
    │ "SUMMER25"   │    │ подтверждению│
    └──────┬───────┘    └──────┬───────┘
           │                   │
           ▼                   │
    ┌──────────────┐           │
    │ API: GET     │           │
    │ /promocodes/ │           │
    │ validate/    │           │
    │ SUMMER25     │           │
    └──────┬───────┘           │
           │                   │
      ┌────┴────┐              │
      │         │              │
      ▼ Valid   ▼ Invalid      │
   ┌─────┐   ┌─────────┐      │
   │Скидка│   │Бот: Проме│     │
   │450₽ │   │код не    │     │
   └──┬──┘   │действ-н  │     │
      │      └────┬─────┘      │
      │           │            │
      └───────┬───┘            │
              │                │
              └────────────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │  Предпросмотр записи:│
          │                      │
          │  📅 Дата: 27.12.2025 │
          │  ⏰ Время: 09:00     │
          │  🛠️ Услуга: ТО      │
          │  💰 Цена: 3000₽     │
          │  🎟️ Промокод: -450₽│
          │  💳 Итого: 2550₽   │
          │                      │
          │  ✅ Подтвердить      │
          │  ❌ Отменить         │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Клиент нажимает      │
          │ "✅ Подтвердить"     │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ API: POST /bookings  │
          │ {                    │
          │   client_id: 1,      │
          │   service_id: 1,     │
          │   date: "2025-12-27",│
          │   time: "09:00",     │
          │   promocode: "..."   │
          │ }                    │
          └──────────┬───────────┘
                     │
        ┌────────────┴────────────┐
        │                         │
        ▼                         ▼
   [БД: INSERT      [БД: UPDATE
    bookings]        timeslots]
        │                         │
        └────────────┬────────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │  Бот: "✅ Запись     │
          │  создана!            │
          │                      │
          │  Номер: B-20251227-001│
          │  Дата: 27.12 в 09:00 │
          │                      │
          │  Ожидайте подтверждения│
          │  администратора"     │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Celery Task (5 мин): │
          │ notify_admin_new_    │
          │ bookings()           │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Уведомление админу:  │
          │ "🆕 Новая запись!"   │
          │ Петров А.А.          │
          │ ТО, 27.12 в 09:00    │
          └──────────────────────┘
                     │
                     ▼
                   [END]
```

---

## 👨‍💼 Администратор - Подтверждение записи

### Сценарий: Обработка новой записи

```
┌─────────────────────────────────────────────────────────┐
│        Админ получает уведомление о новой записи        │
└─────────────────────┬───────────────────────────────────┘
                      │
                      ▼
            ┌─────────────────┐
            │   /admin        │
            └────────┬────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │  Главное меню админа:│
          │                      │
          │  📋 Новые заказы (1) │
          │  ✅ Все заказы       │
          │  📅 Календарь        │
          │  ✏️ Управление       │
          │  📊 Статистика       │
          │  ...                 │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Админ нажимает       │
          │ "📋 Новые заказы"    │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ API: GET /bookings   │
          │ ?status=new          │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │  Бот показывает:     │
          │                      │
          │  📝 Запись #001      │
          │  Клиент: Петров А.А. │
          │  Телефон: +7999...   │
          │  Услуга: ТО          │
          │  Дата: 27.12 в 09:00 │
          │  Авто: BMW X5        │
          │  Госномер: А123BC77  │
          │  Сумма: 2550₽ (-450₽)│
          │                      │
          │  ✅ Подтвердить      │
          │  ❌ Отклонить        │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Админ нажимает       │
          │ "✅ Подтвердить"     │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │  Бот: "Назначить     │
          │  мастера:"           │
          │                      │
          │  🤖 Автоматически    │
          │  👨‍🔧 Иван Петров   │
          │  👨‍🔧 Петр Сидоров  │
          │  👨‍🔧 Мария Иванова │
          └──────────┬───────────┘
                     │
            ┌────────┴────────┐
            │                 │
            ▼ Авто            ▼ Вручную
    ┌──────────────┐   ┌──────────────┐
    │ Система      │   │ Админ выбирает│
    │ находит      │   │ "Иван Петров"│
    │ наименее     │   │              │
    │ загруженного │   └──────┬───────┘
    │ мастера      │          │
    └──────┬───────┘          │
           │                  │
           └──────────┬───────┘
                      │
                      ▼
            ┌──────────────────┐
            │ API: GET         │
            │ /masters/1/      │
            │ schedule         │
            │ ?date=2025-12-27 │
            └────────┬─────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Назначен: Иван Петров│
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │  Бот: "Назначить пост:│
          │                      │
          │  🤖 Автоматически    │
          │  🏢 Пост 1           │
          │  🏢 Пост 2           │
          │  🏢 Пост 3           │
          │  ...                 │
          └──────────┬───────────┘
                     │
            ┌────────┴────────┐
            │                 │
            ▼ Авто            ▼ Вручную
    ┌──────────────┐   ┌──────────────┐
    │ Система      │   │ Админ выбирает│
    │ находит      │   │ "Рабочее место 3"     │
    │ свободное    │   │              │
    │ рабочее место│   └──────┬───────┘
    └──────┬───────┘          │
           │                  │
           └──────────┬───────┘
                      │
                      ▼
          ┌──────────────────────┐
          │ API: PATCH           │
          │ /bookings/1/status   │
          │ {                    │
          │   status: "confirmed",│
          │   master_id: 1,      │
          │   post_id: 3,        │
          │   notify_client: true│
          │ }                    │
          └──────────┬───────────┘
                     │
        ┌────────────┴────────────┐
        │                         │
        ▼                         ▼
   [БД: UPDATE      [БД: INSERT
    bookings]        booking_history]
        │                         │
        └────────────┬────────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │  Бот: "✅ Запись     │
          │  подтверждена!"      │
          │                      │
          │  Мастер: Иван Петров │
          │  Рабочее место: 3             │
          │  Клиент уведомлен    │
          └──────────┬───────────┘
                     │
        ┌────────────┴────────────┐
        │                         │
        ▼                         ▼
[Уведомление         [Уведомление
 клиенту]             мастеру]
        │                         │
        ▼                         ▼
┌──────────────┐      ┌──────────────┐
│"✅ Ваша      │      │"🆕 Новая     │
│запись подт-  │      │запись:       │
│верждена!     │      │Петров А.А.   │
│27.12 в 09:00"│      │ТО, 27.12 09:00"│
└──────────────┘      └──────────────┘
        │                         │
        └────────────┬────────────┘
                     │
                     ▼
                   [END]
```

---

## 👨‍🔧 Мастер - Работа с лист-нарядом

### Сценарий: Получение и выполнение лист-наряда

```
┌─────────────────────────────────────────────────────────┐
│     Celery Task в 08:00 отправляет лист-наряды          │
└─────────────────────┬───────────────────────────────────┘
                      │
                      ▼
          ┌──────────────────────┐
          │ Celery:              │
          │ send_work_orders_to_ │
          │ masters()            │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ API: GET             │
          │ /masters (all)       │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Для каждого мастера: │
          │ API: GET             │
          │ /masters/{id}/schedule│
          │ ?date=today          │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Telegram: отправка   │
          │ лист-наряда мастеру  │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Мастер (Иван Петров) │
          │ получает сообщение:  │
          │                      │
          │ 📋 Лист-наряд        │
          │ на 27 декабря 2025   │
          │                      │
          │ 9:00 - 10:00         │
          │ Услуга: ТО           │
          │ Рабочее место: 3              │
          │ Авто: BMW X5 А123BC77│
          │ Клиент: Петров А.А.  │
          │ Телефон: +7999...    │
          │ Статус: Подтверждена │
          │ [✔️ Завершить]       │
          │                      │
          │ 10:30 - 11:30        │
          │ Услуга: Диагностика  │
          │ ...                  │
          └──────────┬───────────┘
                     │
                     ▼
                   [...]
                     │
                     ▼
          ┌──────────────────────┐
          │ Мастер приступает    │
          │ к работе в 09:00     │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Клиент приезжает     │
          │ (09:00)              │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Мастер выполняет     │
          │ услугу ТО            │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Работа завершена     │
          │ (10:00)              │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Мастер открывает бот │
          │ /master              │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Мастер нажимает      │
          │ [✔️ Завершить]       │
          │ рядом с записью 09:00│
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ API: PATCH           │
          │ /bookings/1/status   │
          │ {                    │
          │   status: "completed"│
          │ }                    │
          └──────────┬───────────┘
                     │
        ┌────────────┴────────────┐
        │                         │
        ▼                         ▼
   [БД: UPDATE      [БД: INSERT
    bookings]        client_history]
        │                         │
        └────────────┬────────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │  Бот: "✅ Запись     │
          │  завершена!"         │
          └──────────┬───────────┘
                     │
        ┌────────────┴────────────┐
        │                         │
        ▼                         ▼
[Уведомление         [Уведомление
 клиенту]             админу]
        │                         │
        ▼                         ▼
┌──────────────┐      ┌──────────────┐
│"✔️ Ваша      │      │"✔️ Запись    │
│услуга        │      │#001 выполнена│
│выполнена!    │      │мастером      │
│Благодарим!"  │      │Иван Петров"  │
└──────────────┘      └──────────────┘
        │                         │
        └────────────┬────────────┘
                     │
                     ▼
                   [END]
```

---

## 🌐 Веб-панель - Управление календарем

### Сценарий: Создание записи через веб-панель

```
┌─────────────────────────────────────────────────────────┐
│         Админ открывает веб-панель (Calendar)           │
└─────────────────────┬───────────────────────────────────┘
                      │
                      ▼
          ┌──────────────────────┐
          │ http://server:3000   │
          │ /calendar            │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ API: GET /calendar   │
          │ ?start_date=...      │
          │ &end_date=...        │
          │ &view=week           │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │  Отображение:        │
          │  Недельный календарь │
          │                      │
          │        ПН  ВТ  СР  ЧТ│
          │  9:00  📝  --  📝  -- │
          │  9:30  --  📝  --  📝│
          │  10:00 📝  📝  --  📝│
          │  ...                 │
          │                      │
          │  📝 = запись         │
          │  -- = свободно       │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Админ кликает на     │
          │ свободный слот:      │
          │ ЧТ 27.12 в 11:00     │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │  Модальное окно:     │
          │  "Создать запись"    │
          │                      │
          │  Клиент: [Петров ▼]  │
          │  Услуга: [ТО ▼]      │
          │  Дата: [27.12.2025]  │
          │  Время: [11:00]      │
          │  Мастер: [Иван ▼]    │
          │  Пост: [3 ▼]         │
          │  Комментарий: []     │
          │                      │
          │  [💾 Создать]        │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Админ заполняет:     │
          │ - Клиент: Петров А.А.│
          │ - Услуга: ТО         │
          │ - Мастер: Иван П.    │
          │ - Пост: 3            │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Админ нажимает       │
          │ [💾 Создать]         │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ API: POST /bookings  │
          │ {                    │
          │   client_id: 1,      │
          │   service_id: 1,     │
          │   date: "2025-12-27",│
          │   time: "11:00",     │
          │   master_id: 1,      │
          │   post_id: 3         │
          │ }                    │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ БД: INSERT bookings  │
          │ status: "confirmed"  │
          │ (сразу подтверждена) │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │  Календарь обновлен: │
          │  Новая запись        │
          │  отображается в слоте│
          │  ЧТ 27.12 11:00      │
          └──────────┬───────────┘
                     │
                     ▼
          ┌──────────────────────┐
          │ Уведомление клиенту  │
          │ и мастеру            │
          └──────────────────────┘
                     │
                     ▼
                   [END]
```

---

## ⏰ Система - Автоматические уведомления

### Сценарий: Цикл уведомлений

```
┌─────────────────────────────────────────────────────────┐
│                Celery Beat (Scheduler)                   │
└─────────────────────┬───────────────────────────────────┘
                      │
        ┌─────────────┼─────────────┐
        │             │             │
        ▼             ▼             ▼
┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│ Каждый день  │ │ Каждый час   │ │ Каждые 5 мин │
│ в 18:00      │ │              │ │              │
└──────┬───────┘ └──────┬───────┘ └──────┬───────┘
       │                │                │
       ▼                ▼                ▼
┌──────────────┐ ┌──────────────┐ ┌──────────────┐
│ Task:        │ │ Task:        │ │ Task:        │
│ send_reminder│ │ send_reminder│ │ notify_admin_│
│ _day_before()│ │ _hour_before()│ │ new_bookings()│
└──────┬───────┘ └──────┬───────┘ └──────┬───────┘
       │                │                │
       │                │                │
       └────────────────┴────────────────┘
                        │
                        ▼
              ┌──────────────────┐
              │ API: GET         │
              │ /bookings        │
              │ (с фильтрами)    │
              └────────┬─────────┘
                       │
                       ▼
              ┌──────────────────┐
              │ Для каждой записи:│
              │ Telegram: send   │
              └────────┬─────────┘
                       │
                       ▼
              ┌──────────────────┐
              │ БД: INSERT       │
              │ notifications    │
              └────────┬─────────┘
                       │
                       ▼
                     [END]
```

### Напоминание за день

```
Время: 26.12.2025 18:00
Запись: 27.12.2025 09:00

Celery Task: send_reminder_day_before()
  ↓
SELECT * FROM bookings
WHERE date = '2025-12-27'
AND status = 'confirmed'
  ↓
Найдена запись: B-20251227-001
  ↓
Telegram: отправка клиенту
  ↓
┌──────────────────────────────────┐
│ 🔔 Напоминание о записи          │
│                                  │
│ Завтра 27 декабря в 09:00        │
│ Услуга: ТО                       │
│ Мастер: Иван Петров              │
│ Пост: 3                          │
│                                  │
│ Ждем вас в салоне красоты!          │
│                                  │
│ [✅ Подтвердить явку]            │
│ [❌ Отменить запись]             │
│ [🔄 Перенести]                   │
└──────────────────────────────────┘
```

### Напоминание за час

```
Время: 27.12.2025 08:00
Запись: 27.12.2025 09:00

Celery Task: send_reminder_hour_before()
  ↓
SELECT * FROM bookings
WHERE date = CURDATE()
AND time BETWEEN NOW() + INTERVAL 50 MINUTE 
            AND NOW() + INTERVAL 70 MINUTE
AND status = 'confirmed'
  ↓
Найдена запись: B-20251227-001
  ↓
Telegram: отправка клиенту
  ↓
┌──────────────────────────────────┐
│ 🔔 Напоминание                   │
│                                  │
│ Через час ваша запись!           │
│ 27 декабря в 09:00               │
│                                  │
│ Адрес: пр.Октября, 123           │
│ Пост: 3                          │
│                                  │
│ До встречи! 👋                   │
│                                  │
│ [✅ Подтвердить]                 │
│ [❌ Отменить]                    │
└──────────────────────────────────┘
```

---

## 📊 Дополнительные сценарии

### Отмена записи клиентом

```
Клиент → Мои записи → Выбор записи → [❌ Отменить]
  ↓
API: PATCH /bookings/{id}/status { status: "cancelled" }
  ↓
БД: UPDATE bookings SET status='cancelled', cancelled_at=NOW()
  ↓
Уведомления:
  - Админу: "❌ Клиент отменил запись #001"
  - Мастеру: "❌ Запись 27.12 09:00 отменена"
  ↓
Освобождение слота
```

### Перенос записи администратором

```
Админ → Веб-панель → Запись #001 → Редактирование
  ↓
Изменение: время с 09:00 на 11:00
  ↓
API: PUT /bookings/1 { time: "11:00" }
  ↓
Проверка доступности нового слота
  ↓
БД: UPDATE bookings, timeslots
  ↓
Уведомления:
  - Клиенту: "📝 Ваша запись перенесена на 11:00"
  - Мастеру: "📝 Запись перенесена на 11:00"
```

### Блокировка даты

```
Админ → Веб-панель → Блокировки → [➕ Добавить]
  ↓
Тип: "Весь салон красоты"
Дата: 31.12.2025 - 01.01.2026
  ↓
API: POST /blocks { block_type: "full_service", ... }
  ↓
БД: INSERT blocked_slots
  ↓
Все слоты на эти даты помечаются как недоступные
  ↓
Клиенты не могут выбрать эти даты в календаре
```

---

**Версия:** 1.0.0  
**Последнее обновление:** 27 декабря 2025